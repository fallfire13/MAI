<HTML>
<HEAD>
<TITLE></TITLE>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=WINDOWS-1251">
</HEAD>
<body background="../fon.jpg">

<p><CENTER><font size="4"><b>ГЛАВА 14
<br>
Условия достоверности, хранимые процедуры, триггеры, представления данных 
</b></font>
</center>
</P>
<br>
<br>

<ul>
  <li><a href="gl14.html#1">Условия достоверности ввода данных на уровне записей</a>
  <li><a href="gl14.html#2">Триггеры</a>
  <li><a href="gl14.html#3">Хранимые процедуры </a>
  <li><a href="gl14.html#4">Использование триггеров и хранимых процедур</a>
  <li><a href="gl14.html#5">Условия достоверности ввода данных на уровне поля таблицы</a>
  <li><a href="gl14.html#6">Использование представлений данных</a>
  <li><a href="gl14.html#7">Создание представления данных</a>
  <li><a href="gl14.html#8">Сохранение созданного представления данных </a>
  <li><a href="gl14.html#9">Просмотр представления данных </a>
  <li><a href="gl14.html#10">Просмотр объема продаж товаров клиентам</a>
  <li><a href="gl14.html#11">Параметры представления данных</a>
  <li><a href="gl14.html#12">Редактирование данных</a>
</ul>

<P>
В реляционных базах данных, к которым относится и Visual FoxPro, для управления данными могут использоваться не только прикладные програм мы, но и непосредственно сервер базы данных. Такая возможность реал ту ется с помощью условий достоверности ввода данных, триггеров и храни мых процедур, которые являются неотъемлемой частью базы данных. 
</P>
<P>
Удобным средством просмотра хранящейся в базе данных информации я и ляются представления данных, которые содержат результат выборки из о.пнш или нескольких таблиц, удовлетворяющих заданному условию. Предстан кния данных имеют много общего с запросами и таблицами. Так же, как и для запросов, вы можете связывать несколько таблиц, указывать отображаемые поля, задавать условие выборки. Просмотр представления данных orv ществляется аналогично просмотру таблицы Visual FoxPro. 
</P>
<p>&nbsp;
<a NAME="1"></a><font size="4">Условия достоверности ввода данных на уровне записей </font> 
</P>
<P>
Условия достоверности позволяют контролировать ввод данных среде там и сервера на уровне записей и полей таблицы. В первом случае условие опрг деляется в окне ввода свойств таблицы, а во втором — в окне свойств и&lt;&gt; ш таблицы. Проверка на уровне записи обычно используется, если необходима проверка при добавлении или удалении записи, а также, если условие про верки изменения записи требует анализа более одного поля. 
</P>
<P>
При определении условий достоверности ввода данных используются трипе ры и 
хранимые процедуры. Триггеры задают действия, выполняемые прибавлении, удалении или изменении записей таблицы. Хранимые процедуры&nbsp; 
cо держат наиболее часто используемые процедуры, выполняемые сервером (и нл данных. Если вы определили условия достоверности ввода данных, их при верка осуществляется независимо от способа изменения данных в таблице 
</P>
<P>
Для определения свойств таблицы откройте окно конструктора для выбранной таблицы и перейдите на вкладку Table (Таблица) (рис. 14.1). 
</P>
<IMG src="gl14-1.jpg" alt="gl14-1.jpg" width="478" height="416" ></IMG>
<P>
Рис. 14.1. Определение свойств таблицы 
</P>
<P>
Для определения достоверности ввода данных могут использоваться триггеры добавления и изменения и поля ввода Rule (Условие) и Message (Сообщение) области Record validation (Проверка правильности ввода записей). В поле Rule (Условие) вводится логическое выражение, которое может содержать вызов хранимой процедуры. Если значение этого выражения равно True (Истина), то считается, что введены допустимые данные и разрешается переход на другую запись или закрытие таблицы. В противном случае выводится сообщение об ошибке, которое было задано в поле Message (Сообщение). 
</P>
<p>&nbsp;
<a NAME="2"></a><font size="4">Триггеры </font> 
</P>
<P>
В Visual FoxPro для таблиц, входящих в состав базы данных, вы можете определить триггеры, приведенные в табл. 14.1. 
</P>
<P>
Таблица 14.1. Триггеры 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Триггер 
</TD>
<TD VALIGN="TOP">
Описание 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Insert (Вставить) 
</TD>
<TD VALIGN="TOP">
Определяет действия, которые будут выполняться после добавления новой записи в таблицу 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Update (Обновить) 
</TD>
<TD VALIGN="TOP">
Определяет действия, которые будут выполняться после изменения записи таблицы 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Delete (Удалить) 
</TD>
<TD VALIGN="TOP">
Определяет действия,  которые будут выполняться после удаления записи из таблицы 
</TD>
</TR>
</TABLE>
<P>
Для определения триггеров введите в поля ввода Insert trigger (Вставить триггер), Update trigger (Обновить триггер) или Delete trigger (Удалить триггер) вкладки Table (Таблица) окна конструктора выбранной таблицы операторы сравнения, вызов хранимой процедуры или любое логическое выражение. Если результат вычисления выражения равен True (Истина), то считается, что введены допустимые значения. В противном случае сохранения введенных данных не происходит и формируется сообщение об ошибке. При использовании хранимых процедур вы сможете не только проверить условие достоверности ввода данных, но и задать действия, выполняемые при добавлении, удалении и изменении данных. 
</P>
<P>
Вызов триггера Delete (Удалить) осуществляется: 
</P>
<ul>
  <li>при выполнении команды DELETE; </li>
  <li>когда вы помечаете запись на удаление в режиме Browse (Обзор) или Edit
(Правка). </li>
</ul>
<P>
Вызов триггера insert (Вставить) осуществляется в следующих случаях: 
</P>
<ul>
  <li>при выполнении команд APPEND FROM, APPEND FROM ARRAY,-APPEND BLANK; </li>
  <li>при добавлении в таблицу новой записи в режиме Browse (Обзор) или Edit (Правка); 
  </li>
  <li>при выполнении команд IMPORT, INSERT SQL, RECALL; </li>
  <li>при снятии метки об удалении записи в режиме Browse (Обзор) или Edit (Правка). 
  </li>
</ul>
<P>
Триггер update (Обновить) вызывается, когда: 
</P>
<ul>
  <li>наступает любое  событие,   которое  приводит  к  модификации  записи (например, при изменении значения поля); 
  </li>
  <li>выполняются команды GATHER, REPLACE, REPLACE  FROM ARRAY, UPDATE SQL. 
  </li>
</ul>
<P>
При использовании триггеров необходимо учитывать ограничения, имеющиеся в Visual FoxPro. 
</P>
<ul>
  <li>При модификации записей, помеченных для удаления, и выполнении команды PACK триггеры не вызываются. 
  </li>
  <li>Выполнение команды ZAP не вызывает триггер Delete (Удалить). </li>
  <li>При использовании буферизации ввода триггер update (Обновить) вызывается только при вызове функции TABLEUPDATE (), 
  </li>
</ul>
<P>
Для удаления триггера в окне конструктора перейдите на вкладку Table (Таблица) и очистите поле ввода выражения для триггера или используйте
Команду DELETE   TRIGGER. 
</P>
<p>&nbsp;
<a NAME="3"></a><font size="4">Хранимые процедуры </font> 
</P>
<P>
Для создания хранимой процедуры выполните следующие действия: 
</P>
<ol>
  <li>В окне проекта выберите базу данных. </li>
  <li>Перейдите в группу Stored Procedures (Хранимые процедуры). </li>
  <li>Нажмите кнопку New (Новый) (рис. 14.2). </li>
</ol>
<IMG src="gl14-2.jpg" alt="gl14-2.jpg" width="500" height="482" ></IMG>
<P>
Рис. 14.2. Для создания хранимой процедуры предназначена группа Stored Procedures окна проекта 
</P>
<ol>
  <li value="4">Открывается окно редактирования хранимых процедур (рис. 14.3), которое содержит все ранее созданные хранимые процедуры, включая процедуры, создаваемые автоматически при определении условий целостности базы данных. 
  </li>
</ol>
<IMG src="gl14-3.jpg" alt="gl14-3.jpg" width="500" height="482" ></IMG>
<P>
Рис. 14.3. Окно редактирования хранимых процедур 
</P>
<P>
<font color="#000080"><b><span lang="ru">Предупреждение</span></b></font></P>
<P>
<font color="#000080">Редактирование или удаление хранимых процедур, которые Visual FoxPro создал автоматически при определении условия целостности данных, могут привести к непредсказуемым последствиям.
</font> 
</P>
<P>
Для редактирования хранимых процедур в Visual FoxPro вы можете использовать команду MODIFY PROCEDURE, которая открывает окно редактирования хранимых процедур текущей базы данных. 
</P>
<P>
Для удаления хранимой процедуры необходимо в окне редактирования выделить текст удаляемой процедуры и нажать клавишу &lt;Delete&gt; или в окне
конструктора проекта установить курсор на ее наименование и выполнить команду Remove (Удалить) окна проекта. 
</P>
<p>&nbsp;
<a NAME="4"></a><font size="4">Использование триггеров и хранимых процедур </font> 
</P>
<P>
Рассмотрим несколько примеров использования триггеров и хранимых процедур для определения условия достоверности ввода данных и начальных значений полей таблицы. 
</P>
<P>
 <b>Определение значения поля при добавлении новой записи </b> 
</P>
<P>
Рассмотрим следующий пример. Чтобы создать для таблицы customer первичный ключ, в таблицу было добавлено поле, содержащее код клиента. Информация в данное поле должна заноситься программно, чтобы не нарушалась уникальность ключа. Для формирования и записи в таблицу кода клиента при добавлении новой записи создадим хранимую процедуру
GetAutoNewNum. 
</P>
<ol>
  <li>Откройте окно проекта sales. </li>
  <li>Создайте в базе данных sales таблицу Records, которая будет использоваться для хранения последних введенных значений кода. Данная таблица содержит два поля. Первое поле предназначено для ввода наименования таблицы, второе — для указания последнего введенного числового кода в данную таблицу. При вызове хранимой процедуры значение второго поля указанной таблицы увеличивается на единицу, и процедура возвращает новое значение кода. Введите в созданную таблицу название таблицы Customer и число, указывающее количество записей, содержащихся в ней. 
  </li>
  <li>Выберите в окне проекта таблицу customer и нажмите кнопку Modify (Модифицировать). 
  </li>
  <li>Для определения свойств поля, содержащего код клиента, перейдите на вкладку Fields (Поля). 
  </li>
  <li>В поле ввода Default value (Значение по умолчанию) области Field validation (Проверка правильности ввода) задайте вызов функции GetAutoNewNum о , введя Getautonewnum(&quot;'Customer &quot;) (рис. 14.4). 
  </li>
  <li>Нажмите кнопку ОК для закрытия конструктора таблицы. </li>
  <li>Теперь необходимо определить функцию GetAutoNewNum. Откройте окно редактирования хранимой процедуры и введите следующие команды: 
  </li>
</ol>
<blockquote>
<P>
 FUNCTION GetAutoNewNum 
</P>
<P>
 LPARAMETERS cNameAliasGANN 
</P>
<P>
 LOCAL nDefaultValueGANN 
</P>
<P>
 IF TYPE(&quot;cNameAliasGANN&quot;)=&quot;L&quot; 
</P>
<P>
 = GetMessage (&quot;Нужно ввести имя таблицы для определения начального 
</P>
<P>
 значения в таблице&quot;+ALIAS()+&quot;!&quot;,48,&quot;Функция GetAutoNewNum&quot;) 
</P>
<P>
 RETURN <span lang="ru">1</span> 
</P>
<P>
 ENDIF 
</P>
<P>
 cNameAliasGANN=ALLTRIM (UPPER (cNameAliasGANN) ) 
</P>
<P>
 DO OpenTable WITH &quot;SALES!RECORDS&quot;, 1 
</P>
<P>
 IF !SEEK{cNameAliasGANN) 
</P>
<P>
 APPEND BLANK 
</P>
<P>
 REPLACE NameOfTable WITH cNameAliasGANN 
</P>
<P>
 REPLACE ColRecordsInTable WITH 1 
</P>
<P>
 ELSE 
</P>
<P>
 REPLACE ColRecordsInTable WITH ColRecordsInTable+1 
</P>
<P>
 ENDIF 
</P>
<P>
 nDefaultValueGANN=ColRecords!nTable 
</P>
<P>
 SELECT (cNameAliasGANN) 
</P>
<P>
 RETURN nDefaultValueGANN 
</P>
</blockquote>
<IMG src="gl14-4.jpg" alt="gl14-4.jpg" width="478" height="416" ></IMG>
<P>
 Рис. 14.4. Задание вызова хранимой процедуры 
</P>
<P>
<b>Проверка удовлетворения введенных значений заданному условию </b> 
</P>
<P>
В данном примере определим условие проверки достоверности ввода данных для 
таблицы ordsaied, содержащей информацию о заказе. Например, при формировании 
накладной отпуска товара в кредит необходимо сравнивать итоговую сумму заказываемых товаров с максимально допустимым кредитом для данного клиента, содержащимся в таблице customer. Проверку будем осуществлять при вводе каждой позиции заказа. 
</P>
<ol>
  <li>Откройте окно проекта sales. </li>
  <li>Выберите в окне проекта таблицу ordsaied и нажмите кнопку Modify (Модифицировать). 
  </li>
  <li>Для определения свойств таблицы перейдите на вкладку Table (Таблица). 
  </li>
  <li>В поле ввода Rule (Условие) области Record validation (Проверка правильности ввода записи) задайте вызов функции checkMaxCredit о, которая сравнивает итоговую сумму заказа с максимально допустимым кредитом клиента. 
  </li>
  <li>В поле Message (Сообщение) области Record validation введите текст сообщения (рис. 14.5) &quot;Вы превысили допустимую сумму кредита клиента&quot;. 
  </li>
</ol>
<IMG src="gl14-5.jpg" alt="gl14-5.jpg" width="478" height="416" ></IMG>
<P>
Рис. 14.5. Определение условия достоверности данных 
</P>
<ol>
  <li value="6">Определим функцию CheckMaxCredit как свойство базы данных, поэтому создадим ее в виде хранимой процедуры. 
  </li>
</ol>
<blockquote>
<P>
Для создания хранимой процедуры CheckMaxCredit в окне редактирования хранимых процедур, которое содержит ранее созданные программы, введите следующий текст: 
</P>
<P>
 procedure CheckMaxCredit 
</P>
<P>
 nCdOrder=Ordsaled.icdOrder  &amp;&amp; номер текущего заказа 
</P>
<P>
 * вычисляем сумму всех введенных позиций заказа 
</P>
<P>
 SELECT SUM(Ordsaied.nQuant*Ordsaled.nUnitPrice); 
</P>
<P>
 FROM Ordsalem, Ordsaied; 
</P>
<P>
 WHERE Ordsalem.icdOrder = Ordsaied.icdOrder; 
</P>
<P>
 AND Ordsaied.icdOrder=nCdOrder; 
</P>
<P>
 INTO ARRAY nSum 
</P>
<P>
 * определяем максимальный кредит клиента из таблицы Customer 
</P>
<P>
 SELECT Customer 
</P>
<P>
 SEEK Ordsalem.icdCustomer 
</P>
<P>
 * если запись о данном покупателе в таблице Customer есть, возвращаем 
</P>
<P>
 * результат сравнения суммы заказа с максимальным кредитом 
</P>
<P>
 IF FOUND( ) 
</P>
<P>
 RETURN nSum(l) &lt; CUSTOMER.yCreditLimit 
</P>
<P>
 ELSE 
</P>
<P>
 RETURN .F. 
</P>
<P>
 ENDIF 
</P>
<P>
 RETURN 
</P>
</blockquote>
<P>
<b>Действия, выполняемые
при добавлении новых записей </b> 
</P>
<P>
Триггеры позволяют не только проверять условие достоверности ввода данных на уровне записей, но и выполнять требуемые действия при добавлении, удалении и изменении записей. Рассмотрим один из примеров использования триггера insert. 
</P>
<P>
В некоторых случаях полезно иметь таблицу, в которой содержится список новых покупателей, которые обратились в вашу фирму за последний месяц. Данная таблица очищается в начале каждого месяца и может использоваться для рассылки рекламной информации новым покупателям. Для хранения списка новых покупателей используется таблица Newcustomer. 
</P>
<P>
В данном примере определим триггер insert для таблицы customer: 
</P>
<ol>
  <li>Откройте окно проекта sales. </li>
  <li>Выберите таблицу customer, содержащую список товаров,  и  нажмите кнопку Modify (Модифицировать). 
  </li>
  <li>Для определения свойств таблицы перейдите на вкладку Table (Таблица) конструктора таблиц. 
  </li>
  <li>В поле ввода Insert trigger (Триггер добавления) задайте вызов функции AddNewCustomer о,     которая    добавляет    новую    запись    в    таблицу
 Newcustomer. </li>
  <li>Для добавления  новой хранимой  процедуры AddNewCustomer откройте окно редактирования хранимых процедур и добавьте в него следующий
текст: </li>
</ol>
<blockquote>
<P>
 procedure AddNewCustomer 
</P>
<P>
 nCurCdCustomer= icdCustomer 
</P>
<P>
 SELECT NewCustomer 
</P>
<P>
 APPEND BLANK 
</P>
<P>
 REPLACE icdCustomer WITH nCurCdCustomer 
</P>
<P>
 SELECT NewCustomer 
</P>
<P>
 RETURN .T. 
</P>
</blockquote>
<p>&nbsp;
<a NAME="5"></a><font size="4">Условия достоверности ввода данных на уровне поля таблицы </font> 
</P>
<P>
Для определения условия достоверности ввода данных на уровне поля таблицы используется область Field validation (Проверка правильности ввода) вкладки Fields (Поля) окна конструктора таблиц. В поле Rule (Условие) задается логическое выражение, а в поле Message (Сообщение) — сообщение, отображаемое на экране, если логическое выражение возвращает значение False (Ложь). 
</P>
<P>
Определим условие достоверности данных для поля nquant, содержащего количество купленного товара, таблицы ordsaied. При вводе количества товара необходимо автоматически проверять его фактическое количество на
складе. 
</P>
<P>
Для определения данного условия достоверности данных выполните следующие действия: 
</P>
<ol>
  <li>Откройте проект sales. </li>
  <li>Перейдите на вкладку Data (Данные). </li>
  <li>В разделе Tables (Таблицы) выберите таблицу ordsaied и нажмите кнопку Modify (Модифицировать). 
  </li>
  <li>В окне конструктора таблицы выберите поле nquant. </li>
  <li>В поле ввода Rule (Условие) области Field validation (Проверка правильности ввода) введите вызов функции checkQuant (). 
  </li>
  <li>В поле ввода Message (Сообщение) введите текст сообщения: &quot;Заказанное количество товара превышает его фактическое количество&quot;Чрис. 14.6). 
  </li>
  <li>Откройте окно редактирования хранимых процедур и добавьте в него новую процедуру CheckQuant: 
<P>
 procedure CheckQuant nCdGoods = Ordsaied.iCdGoods 
</P>
  </li>
</ol>
<blockquote>
<P>
 * определяем фактическое количество товара SELECT nFactQuant; 
</P>
<P>
 FROM Goods; 
</P>
<P>
 WHERE iCdGoods = nCdGoods; 
</P>
<P>
 INTO ARRAY nQuant 
</P>
<P>
 * сравниваем заказанное количество с имеющимся на складе 
</P>
<P>
 RETURN Ordsaied.nQuant(1) &lt;= nQuant(1) 
</P>
</blockquote>
<IMG src="gl14-6.jpg" alt="gl14-6.jpg" width="478" height="416" ></IMG>
<P>
 Рис. 14.6. Определение условия достоверности для поля nquant 
</P>
<p>&nbsp;
<a NAME="6"></a><font size="4">Использование представлений данных </font> 
</P>
<P>
Таблицы базы данных предназначены для хранения данных, а для просмотра данных предпочтительнее использовать представления данных, которые позволяют объединять связанные таблицы, выбирать интересующие вас поля таблиц или объединить несколько полей в одно поле, вычислять итоговые значения, определять новые имена для выбираемых полей таблицы и задавать условие выборки данных. После создания представления данных вы можете использовать его как обычную таблицу в формах, отчетах и при создании запросов. 
</P>
<P>
Представления являются незаменимым средством для ограничения доступа пользователей к отдельным записям таблиц. В этом случае вся работа с базой данных осуществляется через представления данных. 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Описание представления данных хранится в словаре базы данных, поэтому для их просмотра вы должны предварительно открыть базу данных.
</font> 
</P>
<p>&nbsp;
<a NAME="7"></a><font size="4">Создание представления данных </font> 
</P>
<P>
Для создания представления используется конструктор представлений данных. Существует несколько альтернативных способов его вызова.  
</P>
<ul>
  <li>Выберите в меню File (Файл) команду New (Новый).  В открывшемся диалоговом окне установите опцию View (Представление данных) и нажмите кнопку New file (Новый файл). 
  </li>
  <li>В окне конструктора проекта на вкладке Data (Данные) перейдите в раздел Local Views (Локальные представления данных) выбранной базы данных 
  и нажмите кнопку New (Новый). </li>
  <li>Введите в командном окне Command команду CREATE VIEW. </li>
</ul>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">При любом из вариантов вызова для создания представления данных вы можете воспользоваться услугами мастера, который аналогичен мастеру создания запросов.
</font> 
</P>
<P>
При вызове конструктора представлений открывается диалоговое окно Add Table and View (Добавить таблицу или представление данных), позволяющее разместить в конструкторе таблицы и созданные ранее представления данных. Для отображения представлений в этом диалоговом окне необходимо в области Select (Выбор) установить опцию Views (Представления данных). Выбрав необходимую таблицу или представление данных, перенесите их в конструктор, нажав кнопку Add (Добавить). Сформировав список таблиц, нажмите кнопку Close (Закрыть) для закрытия диалогового окна Add Table and View (Добавить таблицу или представление). Выбранные таблицы размещаются в открывшемся на экране окне конструктора представлений данных (рис. 14.7). 
</P>
<P>
Окно конструктора представлений данных похоже на окно конструктора запросов и отличается от последнего некоторыми дополнительно предоставляемыми функциями. 
</P>
<ul>
  <li>Можно указать поля для модификации данных. </li>
  <li>Можно задать параметры, значения которых будут запрашиваться при
открытии представления данных. </li>
  <li>Можно определить количество выбираемых записей. </li>
</ul>
<P align="left">
Для формирования представления данных вы можете использовать команды меню Query 
(Запрос) и кнопки на панели инструментов View Designer
(Конструктор представления данных). Функции кнопок панели инструментов View Designer описаны в табл. 14.2. 
</P>
<IMG src="gl14-7.jpg" alt="gl14-7.jpg" width="500" height="482" ></IMG>
<P>
Рис. 14.7. Окно конструктора представлений данных 
</P>
<P>
Таблица 14.2. Назначение кнопок панели инструментов View Designer 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Кнопка 
</TD>
<TD VALIGN="TOP">
Название 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
<img border="0" src="../key/128.jpg" width="18" height="17"></TD>
<TD VALIGN="TOP">
Add Table (Добавить таблицу) 
</TD>
<TD VALIGN="TOP">
Добавляет в представление новую таблицу или представление данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
<img border="0" src="../key/129.jpg" width="18" height="17"></TD>
<TD VALIGN="TOP">
Remove Table (Удалить таблицу) 
</TD>
<TD VALIGN="TOP">
Удаляет выбранную таблицу из запроса 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
<img border="0" src="../key/130.jpg" width="18" height="17"></TD>
<TD VALIGN="TOP">
Add Join (Добавить объединение) 
</TD>
<TD VALIGN="TOP">
Открывает диалоговое окно Join Condition 
</P>
<P>
(Условие объединения) для задания условия объединения таблиц 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
<img border="0" src="../key/131.jpg" width="18" height="17"></TD>
<TD VALIGN="TOP">
Show the SQL windows 
</P>
<P>
(Показать SQL-оператор) 
</TD>
<TD VALIGN="TOP">
Открывает диалоговое окно, в котором отображается SQL-оператор, соответствующий созданному представлению данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
<img border="0" src="../key/132.jpg" width="18" height="15"></TD>
<TD VALIGN="TOP">
Maximize the table view        (Раскрыть панель представления таблиц) 
</TD>
<TD VALIGN="TOP">
Раскрывает на весь экран панель отображения используемых в представлении таблиц. Повторное нажатие на эту кнопку возвращает панели первоначальный размер 
</TD>
</TR>
</TABLE>
<p>&nbsp;
<a NAME="8"></a><font size="4">Сохранение созданного представления данных </font> 
</P>
<P>
Сформированное в окне конструктора представление данных можно сохранить, выполнив следующие действия: 
</P>
<ol>
  <li>В меню File (Файл) выберите команду Save As (Сохранить как). </li>
  <li>В поле View Name (Имя представления) открывшегося диалогового окна Save (Сохранить) (рис. 14.8) укажите имя созданного представления данных. 
  </li>
  <li>Нажмите кнопку ОК. </li>
</ol>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Обратите внимание, что в отличие от сохранения запроса, вам не требуется указывать место расположения представления, т. к. описание представления хранится в самой базе данных.
</font> 
</P>
<IMG src="gl14-8.jpg" alt="gl14-8.jpg" width="408" height="134" ></IMG>
<P>
Рис. 14.8. Задание имени представления данных 
</P>
<P>
Для открытия сохраненного представления данных из окна проекта необходимо установить на него курсор и нажать кнопку Modify (Модифицировать). 
</P>
<p>&nbsp;
<a NAME="9"></a><font size="4">Просмотр представления данных </font> 
</P>
<P>
После задания в окне конструктора представлений условий для выбора записей и указания результирующих полей, вы можете просмотреть результаты выполнения представления данных. 
</P>
<P>
Для этого выполните одно из следующих действий. 
</P>
<ul>
  <li>Нажмите кнопку Run (Запустить) на стандартной панели инструментов. </li>
  <li>Выберите команду контекстного меню Run Query (Выполнить запрос). </li>
  <li>Выберите в меню Query (Запрос) команду Run Query (Выполнить запрос). </li>
  <li>Нажмите комбинацию клавиш &lt;Ctrl&gt;+&lt;Q&gt;. </li>
</ul>
<P>
На экране появится сформированное представление данных. 
</P>
<P>
Для просмотра созданного представления данных вы можете также использовать окно проекта или окно Data Session (Окно данных). Чтобы просмотреть представления данных в окне проекта, достаточно установить на него курсор и нажать кнопку Browse (Обзор). Если вы просматриваете представление в окне Data Session (Окно данных), откройте его как обычную таблицу и нажмите кнопку Browse (Обзор). 
</P>
<p>&nbsp;
<a NAME="10"></a><font size="4">Просмотр объема продаж товаров клиентам </font> 
</P>
<P>
Рассмотрим пример создания представления данных, которое содержит итоговую сумму покупок клиентов. Представление данных будет содержать наименование предприятия, наименование товара и итоговую сумму покупок клиентом каждого товара. 
</P>
<ol>
  <li>Откройте окно конструктора представлений и добавьте в него таблицы 
  Customer, Ordsalem, Ordsaled И Goods, используемые <span lang="ru">для с</span>оздания
  <span lang="ru">нового</span> представления. </li>
  <li>Установите связи между размещенными в окне конструктора таблицами. При создании связей между таблицами необходимо учитывать, что связь между ними осуществляется по следующим полям: 
  </li>
</ol>
<ul>
  <li>Customer <span lang="ru">и</span> Ordsalem — <span lang="ru">по коду</span> клиента; 
  </li>
  <li>Ordsalem <span lang="ru">и</span> Ordsaled — <span lang="ru">по код</span>у заказа; 
  </li>
  <li>Ordsaled <span lang="ru">и</span> Goods  <span lang="ru">по</span> коду товара. 
  </li>
</ul>
<blockquote>
<P>
Если в конструкторе базы данных вы определили постоянные связи между таблицами, то в окне конструктора они установятся автоматически. 
</P>
</blockquote>
<ol>
  <li value="3">В список Selected fields (Выбранные поля) перенесите название фирмы, имя клиента и наименование товара. 
  </li>
  <li>Добавьте в список Selected fields (Выбранные поля) вычисляемое поле, содержащее сумму продаж: 
<P>
 SUM(Ordsaled.nQuant * Ordsaled.nUnitPrice) 
</P>
<P>
&nbsp;</P>
  </li>
  <li>Задайте группировку данных по названию предприятия и наименованию товара. 
  </li>
  <li>Для сохранения представления данных в меню File (Файл) выберите команду Save As (Сохранить как). В поле View Name (Имя представления) открывшегося диалогового окна Save (Сохранить) укажите имя создаваемого представления данных Sumcust и нажмите кнопку ОК. 
  </li>
  <li>Просмотрите созданное представление данных, нажав кнопку Run (Выполнить) на стандартной панели инструментов. 
  </li>
  <li>Закройте окно конструктора представлений. </li>
</ol>
<P>
Вы можете просмотреть созданное представление данных в окне Data Session (Окно данных). Для этого выполните следующие действия: 
</P>
<ol>
  <li>В меню Windows (Окна) выберите команду Data Session (Окно данных). </li>
  <li>Нажмите кнопку Browse (Обзор). </li>
  <li>В   открывшемся   диалоговом   окне   Open   (Открыть)   в   области   Select (Выбор) установите опцию Views (Представления данных). 
  </li>
  <li>Выберите из списка Views in database (Представления данных в базе данных) (рис. 14.9) требуемое представление данных и нажмите кнопку ОК. 
  </li>
</ol>
<IMG src="gl14-10.jpg" alt="gl14-10.jpg" width="247" height="273" ></IMG>
<P>
Рис. 14.9. Выбор представления данных 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">При открытии представления данных в окне Data Session (Окно данных) показывается не только выбранное представление, но и все таблицы, используемые при его создании (рис, 14.10).
</font> 
</P>
<IMG src="gl14-11.jpg" alt="gl14-11.jpg" width="500" height="389" ></IMG>
<P>
Рис. 14.10. Окно Data Session после открытия представления данных Sumcust 
</P>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">Для открытия представления данных вы можете также в командном окне или в программе воспользоваться командой USE.
</font> 
</P>
<p>&nbsp;
<a NAME="11"></a><font size="4">Параметры представления данных </font> 
</P>
<P>
В Visual FoxPro при создании представления данных вы можете задать параметры представления. Значения этих параметров будут запрашиваться при открытии представления. Например, в предыдущем примере мы создали представление данных, которое содержит итоговые объемы продаж товаров. Использование параметров позволит вам выбирать не все продажи, а объем продаж за определенный интервал времени, продажи конкретного товара или покупки определенного клиента. 
</P>
<P>
При открытии представления, для которого заданы параметры, запрашиваются значения заданных параметров, и выборка данных осуществляется с учетом введенных значений. Для определения параметров используется команда View Parameters (Параметры представления данных) из меню Query (Запрос). 
</P>
<P>
Добавим в созданное в предыдущем примере представление данных параметр, указывающий дату, для которой будет осуществляться выборка. 
</P>
<ol>
  <li>Выберите в окне проекта представление данных sumCust и нажмите кнопку Modify (Модифицировать). 
  </li>
  <li>В окне конструктора представления данных в меню Query (Запрос) выберите команду View Parameters (Параметры представления данных). На экране открывается соответствующее диалоговое окно. Это диалоговое окно содержит список всех параметров представления, для каждого из которых заданы имя параметра и его тип. 
  </li>
  <li>Введите параметр Date_View и определите для него тип данных Date.</li>
</ol>
<ol>
  <li value="4">Определите условие выборки данных для заданной даты. Для этого 
  перейдите на вкладку Filter (Фильтр) и добавьте условие для поля ordsaiem.dDoc. Для выбора значения за конкретную дату используйте оператор ==, а в поле ввода Example (Образец) введите ?Date_View. 
  </li>
</ol>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Вопросительный знак перед именем параметра является признаком использования параметра.
</font> 
</P>
<ol>
  <li value="5">Сохраните представление данных. </li>
  <li>Для просмотра итоговых продаж товаров за конкретный день откройте представление данных SumCust. Поскольку для представления определен параметр, на экране появляется диалоговое окно View Parameter (Параметр представления данных), предлагающее ввести значение параметра.</li>
</ol>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Если при создании представления данных вы задали несколько параметров, то для ввода значения каждого параметра будет открываться отдельное окно.
</font> 
</P>
<ol>
  <li value="7">Введите значение параметра и нажмите кнопку ОК. На экране появится выборка записей, соответствующих дате, введенной в окне View Parameter (Параметр представления данных). 
  </li>
</ol>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Диалоговое окно View Parameter (Параметры представления данных) для ввода значения параметра рекомендуется использовать только при отладке представления. Вы можете определить переменные, наименования которых совпадают с именем параметра, и присвоить им требуемые значения в программе или в форме. В этом случае при открытии представления параметры запрашиваться не будут.
</font> 
</P>
<p>&nbsp;
<a NAME="12"></a><font size="4">Редактирование данных </font> 
</P>
<P>
В Visual FoxPro представления данных могут использоваться не только для просмотра результатов выборки данных, но и для редактирования таблиц, которые использовались при его создании. Создавая представления данных, вы можете указать признак редактирования выбираемых полей базовых таблиц. Таким образом, вы можете задать список полей для просмотра и редактирования. Например, при изменении фамилии, имени и отчества клиента вы должны видеть на экране наименование фирмы, фамилию, имя и отчество клиента, но можете редактировать только поля, содержащие фамилию, имя и отчество. 
</P>
<P>
Для определения таблиц и полей, которые будут изменяться при модификации данных с помощью представления, используется вкладка Update Criteria (Критерий обновления).</P>
<P>
Перечень всех таблиц, поля которых используются для создания представления, 
приведен в раскрывающемся списке Table (Таблица). При выборе таблицы из этого 
списка в области Field name (Имя таблицы) отображается список выбранных полей. 
Для каждого поля вы можете определить признаки ключевого поля и разрешения модификации, которые устанавливаются с помощью флажка в столбцах, заголовки которых содержат изображение ключа и карандаша соответственно. </P>
<P>
Кнопка Reset Key (Сброс ключа) устанавливает исходное состояние флажков разрешения модификации и ключевых полей. При этом сбрасываются все флажки в столбце разрешения модификации, а флажки в столбце признака ключевых полей устанавливаются только для тех полей, которые являются первичными ключами. 
</P>
<P>
Кнопка Update All (Обновить все) устанавливает флажки в столбце разрешения модификации для всех полей, кроме ключевых. 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Все выбранные на вкладке Update Criteria (Критерий обновления) параметры действительны только в том случае, если установлен флажок Send SQL updates (Отправить SQL-обновление).
</font> 
</P>
<P>
<b>Установка редактируемых полей </b> 
</P>
<P>
Рассмотрим последовательность действий при создании представления данных, позволяющего редактировать информацию в полях, содержащих фамилию, имя и отчество клиента. 
</P>
<ol>
  <li>Откройте окно конструктора представлений и добавьте в него таблицу
customer. </li>
  <li>В  список Selected fields  (Выбранные поля)  перенесите  наименование
фирмы ccompany, <span lang="ru">а</span> также clastname, cf irstname 
  <span lang="ru">и</span> csecondname. </li>
  <li>Для определения редактируемых полей  перейдите на вкладку Update Criteria (Критерий обновления). 
  </li>
  <li>Установите флажки разрешения редактирования для полей clastname,
cfirstname <span lang="ru">и</span> csecondname. </li>
  <li>Установите   флажок   Send   SQL   updates   (Отправить   SQL-обновление).</li>
</ol>
<ol>
  <li value="6">Сохраните представление данных и откройте его для редактирования данных в режиме Browse (Обзор).</li>
</ol>
</BODY>
</HTML>