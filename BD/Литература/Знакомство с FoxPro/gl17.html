<HTML>
<HEAD>
<TITLE></TITLE>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=WINDOWS-1251">
</HEAD>
<body background="../fon.jpg">

<p><CENTER><font size="4"><b>ГЛАВА 17
<br>
Расширенные средства создания отчетов</b></font>
</center>
</P>
<br>
<br>

<ul>
  <li><a href="gl17.html#1">Использование в отчетах представлений данных</a>
  <li><a href="gl17.html#2">Этикетки</a>
  <li><a href="gl17.html#3">Использование мастера при создании этикеток</a>
  <li><a href="gl17.html#4">Создание этикетки с помощью конструктора </a>
  <li><a href="gl17.html#5">Использование в отчетах отношения "один-ко-многим"</a>
</ul>


<P>
Вопросы создания отчетов нами уже обсуждались. В этой главе рассмотрим 
использование при создании отчетов представлений данных, создание отчетов для таблиц, имеющих отношение &quot;один-ко-многим&quot;, а также конструирование этикеток. 
</P>
<p>&nbsp;
<a NAME="1"></a><font size="4">Использование в отчетах представлений данных </font> 
</P>
<P>
В главе 14 мы познакомились с представлениями данных, содержащими результат выборки из базовых таблиц базы данных. Их удобно использовать при создании отчетов, т. к. задавая параметры для представлений данных, можно печатать отчеты, содержащие информацию за определенный интервал времени, о конкретном клиенте и т. п. 
</P>
<P>
Рассмотрим создание отчета, данные для которого находятся в представлении данных, содержащем итоговые суммы продаж по клиентам. 
</P>
<ol>
  <li>Откройте проект Sales. </li>
  <li>Для создания нового отчета откройте окно конструктора отчетов. </li>
  <li>Откройте окно Data Environment (Среда окружения), выполнив команду Environment (Окружение) из меню View (Вид) или выбрав команду Data Environment (Среда окружения) всплывающего меню. 
  </li>
  <li>Для добавления представления данных в среду окружения выполните команду Add (Добавить) из меню Data Environment (Среда окружения). 
  </li>
  <li>В открывшемся диалоговом окне Add Table or View (Добавить таблицу или 
  представление данных) установите опцию View (Представление данных) и выберите из списка представление данных sumcust. 
  </li>
  <li>Закройте окно Data Environment (Среда окружения). </li>
  <li>Создайте стандартный отчет, используя команду Quick Report (Стандартный отчет) из меню Report (Отчет). При создании отчета воспользуйтесь 
  размещением по строкам и выберите все поля представления данных. </li>
  <li>Скорректируйте заголовки полей в полосе Page Header (Верхний колонтитул) отчета. 
  </li>
  <li>Добавьте   в   отчет   группировку   по   коду   клиента,   воспользовавшись командой Data Grouping (Группировка данных) из меню Report (Отчет). 
  </li>
  <li>В полосе Group Footer (Группа снизу) создайте итоговое поле, которое будет суммировать продажи по каждому клиенту. 
  </li>
  <li>Добавьте в отчет полосы для размещения заголовка и итоговой части отчета, выполнив команду Title/Summary (Титул/Итоги) из меню Report (Отчет). 
  </li>
  <li>В заголовке отчета введите текст Стоимость продаж по клиентам. </li>
</ol>
<p>&nbsp;
<a NAME="2"></a><font size="4">Этикетки </font> 
</P>
<P>
На практике часто возникает необходимость в создании отчетов, предназначенных для рассылки информации рекламного характера потенциальным клиентам или рассылки сведений о результатах деятельности предприятия за отчетный период. В Visual FoxPro для этих целей имеется специальный тип отчетов и соответствующий мастер для создания почтовых этикеток. В данном разделе мы рассмотрим создание этикеток, как с помощью мастера, так и в окне конструктора этикеток. 
</P>
<p>&nbsp;
<a NAME="3"></a><font size="4">Использование мастера при создании этикеток </font> 
</P>
<P>
Сначала рассмотрим создание этикетки с помощью мастера. Выполните следующие действия: 
</P>
<ol>
  <li>Откройте созданный проект. </li>
  <li>Выберите вкладку Documents (Документы). </li>
  <li>Установите курсор в группу Labels (Этикетки) и нажмите кнопку New (Новый) окна конструктора проекта. 
  </li>
  <li>Открывается диалоговое окно New Label (Новая этикетка). Выберите в нем опцию Label Wizard (Мастер этикетки). 
  </li>
</ol>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">Для запуска мастера создания этикеток вы можете также в меню Tools (Сервис) выбрать команду Wizards (Мастера), а затем в открывшемся меню — опцию Label (Этикетка).
</font> 
</P>
<ol>
  <li value="5">Запускается мастер по созданию почтовой этикетки. В его первом диалоговом окне выберите источник данных (рис. 17.1), т. е. укажите таблицу, из которой будут выбираться данные, и нажмите кнопку Next (Далее). 
  </li>
  <li>На втором шаге из предложенного списка наиболее часто используемых размеров этикеток выберите подходящий (рис. 17.2). Столбец Avery содержит наименования этикеток. В столбце Dimensions (Размеры) отображается 
  размер этикетки, а в столбце Columns (Колонки) — количество колонок этикеток, 
  помещаемых на странице. По умолчанию размер этикеток указывается в дюймах, а при установке опции Metric (Размерность) — в миллиметрах. 
  </li>
</ol>
<blockquote>
<P>
В этот список можно добавить новые размеры этикеток. Для этого нажмите кнопку New Label (Новая этикетка). Открывается диалоговое окно Custom Labels (Пользовательские этикетки) (рис. 17.3) со списком пользовательских этикеток. В этом окне можно ввести новые размеры этикеток или изменить существующие. 
</P>
</blockquote>
<IMG src="gl17-2.jpg" alt="gl17-2.jpg" width="492" height="360" ></IMG>
<P>
Рис. 17.1. Выбор источника данных для создания этикеток 
</P>
<IMG src="gl17-3.jpg" alt="gl17-3.jpg" width="492" height="360" ></IMG>
<P>
Рис. 17.2. Выбор типа этикетки 
</P>
<blockquote>
<P>
Для создания новой или редактирования существующей этикетки необходимо нажать кнопку New (Новый) или Edit (Редактировать) соответственно. При этом открывается диалоговое окно New Label Definition (Определение размеров новой этикетки) (рис. 17.4), позволяющее ввести размеры этикетки или отредактировать установленные. Введите на схеме размеры этикетки, введите в поле Label Name (Наименование этикетки) наименование этикетки и нажмите кнопку Add (Добавить) или Update (Обновить) для добавления или изменения этикетки соответственно. 
</P>
</blockquote>
<IMG src="gl17-4.jpg" alt="gl17-4.jpg" width="453" height="240" ></IMG>
<P>
Рис. 17.3. Диалоговое окно Custom Labels
со списком пользовательских размеров 
</P>
<IMG src="gl17-5.jpg" alt="gl17-5.jpg" width="500" height="384" ></IMG>
<P>
Рис. 17.4. Диалоговое окно New Label Definition
для определения нового размера этикетки 
</P>
<ol>
  <li value="7">На третьем шаге создания этикетки необходимо расположить поля, 
  знаки пунктуации (точка, запятая, дефис, пробел, двоеточие), сформировав текст 
  этикетки. Этикетка заполняется последовательно, поэтому перед переносом в нее 
  объектов тщательно спланируйте их размещение в этикетке. Для формирования адреса выполните следующие действия: 
  </li>
</ol>
<ul>
  <li>перенесите из списка Available fields (Имеющиеся поля) в список Selected fields (Выбранные поля) поле, содержащее почтовый индекс. Для этого дважды щелкните на поле или нажмите кнопку со стрелкой; 
  </li>
  <li>чтобы разместить запятую, нажмите кнопку с изображением запятой; </li>
  <li>для размещения пробела перед названием страны нажмите кнопку Space (Пробел); 
  </li>
  <li>перенесите поле, содержащее название страны; </li>
  <li>если необходимо расположить данные с новой строки, нажмите кнопку с изображением изогнутой стрелки; 
  </li>
  <li>аналогично расположите остальные поля этикетки. </li>
</ul>
<P>
Разместив   все   необходимые   поля   (рис. 17.5),   нажмите   кнопку   Next (Далее) для перехода к следующему шагу. 
</P>
<IMG src="gl17-6.jpg" alt="gl17-6.jpg" width="492" height="360" ></IMG>
<P>
Рис. 17.5. Расположение объектов в этикетке 
</P>
<ol>
  <li value="8">Теперь следует задать порядок сортировки данных (рис. 17.6). Перенесите из списка Available fields or index tag (Имеющиеся поля и индексы) в список Selected fields (Выбранные поля) поля или индексы, по которым хотите упорядочить этикетки. Нажмите кнопку Next (Далее). 
  </li>
  <li>В последнем окне мастера укажите вариант завершающих действий (сохранение этикетки, сохранение и открытие ее в конструкторе этикеток или сохранение и печать), выбрав соответствующую опцию. 
  </li>
</ol>
<P>
При выборе второй опции созданная этикетка сохраняется на диске и открывается в окне конструктора этикеток (рис. 17.7). На рис. 17.8 показана созданная с помощью мастера этикетка в окне предварительного просмотра. 
</P>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">В том случае, если при создании этикеток вы хотите использовать вычисляемые поля для объединения полей исходной таблицы, отображения инициалов вместо полного имени и отчества и т. п., предварительно создайте представление данных, содержащее всю необходимую информацию в том виде, в каком нужно, и используйте его при создании этикеток с помощью мастера.
</font> 
</P>
<IMG src="gl17-7.jpg" alt="gl17-7.jpg" width="492" height="360" ></IMG>
<P>
Рис. 17.6. Определение порядка сортировки 
</P>
<IMG src="gl17-8.jpg" alt="gl17-8.jpg" width="500" height="420" ></IMG>
<P>
Рис. 17.7. Созданная этикетка в окне конструктора этикеток 
</P>
<IMG src="gl17-9.jpg" alt="gl17-9.jpg" width="500" height="360" ></IMG>
<P>
Рис. 17.8. Созданная этикетка в окне просмотра 
</P>
<p>&nbsp;
<a NAME="4"></a><font size="4">Создание этикетки
с помощью конструктора </font> 
</P>
<P>
При создании сложных этикеток вы можете использовать конструктор этикеток. Для его открытия выполните одно из следующих действий. 
</P>
<ul>
  <li>В меню File (Файл) выберите команду New (Новый). В открывшемся диалоговом окне New (Новый) установите опцию Label (Этикетка) и нажмите кнопку New file (Новый файл). 
  </li>
  <li>Нажмите кнопку New (Новый), предварительно выбрав на вкладке Documents (Документы) в окне проекта группу Labels 
  (Этикетки) и в открывшемся диалоговом окне New Label (Новая этикетка) выберите опцию New Label (Новая этикетка). 
  </li>
</ul>
<P>
Открывается диалоговое окно New Label (Новая этикетка) (рис. 17.9), где в табличном виде находится список наиболее часто используемых этикеток. Столбцы таблицы имеют следующее назначение: 
</P>
<ul>
  <li>Avery No — наименование (номер) этикетки; </li>
  <li>Height — высота этикетки; </li>
  <li>Width — ширина этикетки; </li>
  <li>Columns — число колонок. </li>
</ul>
<P>
Выберите из предложенных вариантов требуемый тип этикетки и нажмите кнопку ОК. На экране откроется окно конструктора этикеток (рис. 17.10). 
</P>
<IMG src="gl17-10.jpg" alt="gl17-10.jpg" width="407" height="188" ></IMG>
<P>
Рис. 17.9. Диалоговое окно New Label 
</P>
<IMG src="gl17-11.jpg" alt="gl17-11.jpg" width="500" height="371" ></IMG>
<P>
Рис. 17.10. Окно конструктора этикеток 
</P>
<P>
Окно конструктора этикеток выглядит примерно так же, как окно конструктора отчетов. Отличие заключается в том, что для этикетки заданы размеры
отчета и количество колонок в отчете. В остальном создание этикетки аналогично созданию отчета. 
</P>
<P>
Рассмотрим создание этикетки на примере подготовки адресов для рассылки корреспонденции клиентам, используя информацию из таблицы customer. Этот пример аналогичен примеру создания многоколоночного отчета, описание которого дано в главе 8. 
</P>
<P>
Основное преимущество этикеток, по сравнению с отчетами, состоит в автоматическом 
выборе размеров этикетки и расстояния между ними. Нет необходимости 
самостоятельно рассчитывать размер получаемого отчета и заботиться о том, чтобы он поместился на бумаге. При печати на обычной бумаге это преимущество не вполне очевидно, но как только вы начнете использовать для этих целей специальные листы с наклейками, вы ощутите удобство выбора типа наклейки. 
</P>
<P>
Для создания этикетки выполните следующие действия: 
</P>
<ol>
  <li>В меню File (Файл) выберите команду New (Новый). В открывшемся диалоговом окне New (Новый) установите опцию Label (Этикетка) и нажмите кнопку New file (Новый файл). 
  </li>
  <li>В открывшемся диалоговом окне New Label (Новая этикетка), содержащем 
  список типов наиболее часто используемых этикеток, выберите этикетку такого типа, которая удовлетворяет вашим требованиям. 
  </li>
  <li>Откройте окно Data Environment (Среда окружения) и добавьте в него таблицу Customer. 
  </li>
  <li>Воспользовавшись командой Quick Report (Стандартный отчет) из меню Report 
  (Отчет), перенесите в этикетку поля, содержащие почтовый индекс, страну проживания клиента, его адрес, фамилию, имя и отчество. При этом выберите размещение полей по строкам. 
  </li>
  <li>В окне конструктора разместите поля так, как это принято для почтовых этикеток в конкретной стране. В рассматриваемом примере будем считать, что почтовые этикетки изготавливаются для рассылки в пределах СНГ, поэтому расположим их так, как показано на рис. 17.11.  
  </li>
  <li>Просмотрите созданные этикетки в окне просмотра. В результате вы увидите отчет, показанный на рис. 17.12. 
  </li>
</ol>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">В том случае, если вы хотите изменить количество этикеток, печатаемых на одной странице, или порядок их расположения, выберите в меню File (Файл) команду Page Setup (Разметка страницы). Затем в открывшемся диалоговом окне Page Setup (Разметка страницы) установите новые значения параметров, как при работе с обычным отчетом.
</font> 
</P>
<ol>
  <li value="7">Сохраните созданную этикетку. Для этого в меню File (Файл) выберите команду Save as (Сохранить как). 
  </li>
</ol>
<IMG src="gl17-12.jpg" alt="gl17-12.jpg" width="500" height="371" ></IMG>
<P>
Рис. 17.11. Расположение полей при создании почтовых этикеток 
</P>
<IMG src="gl17-13.jpg" alt="gl17-13.jpg" width="500" height="360" ></IMG>
<P>
Рис. 17.12. Просмотр почтовых этикеток 
</P>
<ol>
  <li value="8">Если работа над этикетками закончена, напечатайте их, воспользовавшись командой Print (Печать) из меню File (Файл). 
  </li>
</ol>
<p>&nbsp;
<a NAME="5"></a><font size="4">Использование в отчетах отношения &quot;один-ко-многим&quot;
</font> 
</P>
<P>
Visual FoxPro поддерживает в отчетах отношение &quot;один-ко-многим&quot;. Эта возможность 
упрощает отображение в отчете иерархических данных. Добавим в форму просмотра 
телефонов клиентов и их заказов, созданную в главе 75, средства для печати 
телефонов клиента, информация о котором отображена в форме. Для этого в форме 
расположим кнопку для печати телефонов (рис. 17.13) и создадим соответствующий отчет. 
</P>
<ol>
  <li>Откройте Проект Sales. </li>
  <li>Откройте для модификации форму Клиенты и продажи. </li>
  <li>Добавьте в форму кнопку с надписью Печать. </li>
  <li>Откройте окно свойств кнопки. Выберите метод click (Нажатие) и введите в окне процедуры следующий текст программы вызова отчета: 
  </li>
</ol>
<blockquote>
<P>
 curiCdCustomer=icdCustomer  
</P>
<P>
 REPORT FORM RepCust TO PRINTER; 
</P>
<P>
 FOR PhonCust.icdCustomer=curiCdCustomer 
</P>
<P>
 SELECT PhonCust  
</P>
<P>
 SET SKIP TO 
</P>
<P>
 select Customer  
</P>
<P>
 ThisForm.Refresh() 
</P>
</blockquote>
<ol>
  <li value="5">Откройте новое окно конструктора отчетов и добавьте в окно Data Environment (Среда окружения) таблицы customer и PhonCust. 
  </li>
  <li>Главной таблицей отчета является Customer, а подчиненной по отношению к ней — таблица PhonCust. Установите связи между этими таблицами и определите свойство опетомапу (Один-ко-многим), выбрав значение True (Истина) (рис. 17.14). 
  </li>
  <li>В заголовке отчета расположите его название. </li>
  <li>Добавьте в отчет группировку по коду клиента. </li>
  <li>В полосе Group Header (Группа сверху) разместите поля из таблицы customer и надписи к ним, а также надписи к полям из таблицы phoncust. 
  </li>
  <li>В полосе Detail (Детали) разместите поля из таблицы Phoncust. </li>
  <li>Созданный отчет представлен на рис. 17.15. Сохраните отчет под именем RepCust. 
  </li>
  <li>Запустите на выполнение форму Клиенты и продажи. Для печати телефонов клиента, на котором установлен курсор, нажмите кнопку Печать телефонов. На рис. 17.16 приведен вариант просмотра отчета на экране. 
  </li>
</ol>
<IMG src="gl17-14.jpg" alt="gl17-14.jpg" width="500" height="383" ></IMG>
<P>
Рис. 17.13. Форма Клиенты и продажи 
</P>
<IMG src="gl17-15.jpg" alt="gl17-15.jpg" width="500" height="463" ></IMG>
<P>
Рис. 17.14. Установка отношения &quot;один-ко-многим&quot; 
</P>
<IMG src="gl17-16.jpg" alt="gl17-16.jpg" width="500" height="438" ></IMG>
<P>
Рис. 17.15. Отчет для печати телефонов клиентов 
</P>
<IMG src="gl17-17.jpg" alt="gl17-17.jpg" width="500" height="438" ></IMG>
<P>
Рис. 17.16. Отчет для печати телефонов клиентов в окне просмотра 
</P>
</BODY>
</HTML>