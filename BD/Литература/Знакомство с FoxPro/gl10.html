<HTML>
<HEAD>
<TITLE></TITLE>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=WINDOWS-1251">
</HEAD>
<body background="../fon.jpg">

<p><CENTER><font size="4"><b>ГЛАВА 10 
<br>
Перекрестные таблицы и диаграммы</b></font>
</center>
</P>
<br>
<br>

<ul>
  <li><a href="gl10.html#1">Перекрестные таблицы</a>
  <li><a href="gl10.html#2">Одномерные перекрестные таблицы</a>
  <li><a href="gl10.html#3">Двумерные перекрестные таблицы </a>
  <li><a href="gl10.html#4">Создание перекрестной таблицы с помощью мастера</a>
  <li><a href="gl10.html#5">Программа создания перекрестной таблицы</a>
  <li><a href="gl10.html#6">Экспорт данных</a>
  <li><a href="gl10.html#7">Построение диаграмм</a>
  <li><a href="gl10.html#8">Создание диаграммы с помощью мастера Graph Wizard</a>
  <li><a href="gl10.html#9">Создание трехмерных диаграмм</a>
</ul>

<P>
В Visual FoxPro имеются мощные средства анализа большого объема информации, хранящегося в базе данных в одной или нескольких таблицах —диаграммы и перекрестные таблицы.
</P>
<P>
Отображение данных в виде диаграмм и графиков позволяет решать самыеразные задачи. Основное достоинство такого представления — наглядность.На диаграммах хорошо просматриваются тенденции к изменению, различные соотношения, прирост, взаимосвязь различных процессов и т. д.
</P>
<P>
Но, как правило, таблицы не подготовлены для создания диаграмм. Данныев них представлены в виде нескольких составляющих, расположенных вбольшом количестве записей. Диаграмма, построенная для такой таблицы,будет иметь вид, который трудно использовать для анализа. Поэтому, прежде чем строить диаграмму, информацию необходимо преобразовать к виду,наиболее приемлемому для построения диаграмм. Для этого в Visual FoxProиспользуются перекрестные таблицы и итоговые запросы.
</P>
<P>
Перекрестная таблица - это таблица, в которой информация группируется всоответствии со значениями одного или нескольких полей и фактическиприводится к виду, аналогичному электронной таблице.
</P>
<P>
В Visual FoxPro для построения диаграмм используется Microsoft Graph.Помимо этого, для построения диаграмм из подготовленных в Visual FoxProданных вы можете использовать Microsoft Excel и другие электронные таблицы, имеющиеся в среде Windows.
</P>
<p>&nbsp;
<a NAME="1"></a><font size="4">Перекрестные таблицы </font>
</P>
<P>
Перекрестная таблица в Visual FoxPro имеет вид, похожий на электроннуютаблицу. Но, в отличие от последней, вам не нужно вручную заполнять каждую ячейку таблицы, предварительно определив ее значение. Visual FoxProавтоматически разбивает данные на группы в соответствии с одним или несколькими факторами и выполняет итоговые вычисления над данными,включенными в группу. После чего информация, полученная в результатегрупповых вычислений, сортируется и заносится в перекрестную таблицу.Например, 
используя перекрестную таблицу, вы можете определить, сколько клиентов фирмы проживает в том или ином районе города или как распределяются между ними проданные товары. Очевидно, что каждый клиентможет покупать один и тот же товар несколько раз. Получить такие сведения без создания перекрестной таблицы достаточно трудно. </P>
<P>
При работе с Visual FoxPro вы можете использовать одномерные и многомерные перекрестные таблицы. Для создания простейших одномерных перекрестных таблиц применяйте обычный итоговый запрос. Для построениядвумерных и более сложных перекрестных таблиц в Visual FoxPro используется мастер создания перекрестных таблиц Cross-Tab Wizard (Мастер построения перекрестных таблиц).
</P>
<P>
Прежде чем приступить непосредственно к созданию перекрестной таблицы, вы должны определить, какой тип перекрестных таблиц в наибольшейстепени подходит к выполнению текущей задачи.
</P>
<p>&nbsp;
<a NAME="2"></a><font size="4">Одномерные перекрестные таблицы </font>
</P>
<P>
Простейшим типом перекрестной таблицы является одномерная перекрестная таблица, используемая для анализа распределения данных одного типапо одному фактору.
</P>
<IMG src="gl10-1.jpg" alt="gl10-1.jpg" width="500" height="395"></IMG>
<P>
Рис. 10.1. Одномерная перекрестная таблица
</P>
<P>
Рассмотрим создание перекрестной таблицы, отображающей распределениеклиентов по городам (рис. 10.1). Исходная информация содержится в таблице Customer.
</P>
<ol>
  <li>В окне проекта на вкладке Data (Данные) выберите группу Queries(Запросы) и нажмите кнопку New (Новый). 
  </li>
  <li>Добавьте в окно конструктора запросов таблицу Customer со спискомклиентов. 
  </li>
  <li>На вкладке Fields (Поля) окна конструктора запросов разместите в списке Selected fields (Выбранные поля) поле ccity и итоговое полеCOUNT (icdcustomer), подсчитывающее количество клиентов. 
  </li>
  <li>На вкладках Group By (Группировка) и Order By (Упорядочение) установите группировку и упорядочение по полю ccity. 
  </li>
  <li>Выполните команду Run Query (Выполнить запрос) меню Query (Запрос). </li>
  <li>Сохраните результат выборки в таблице cntcust, воспользовавшись дляэтого кнопкой Query Destination (Результаты запроса) панели инструментов Query Designer (Конструктор запроса). Данная таблица будет содержать распределение клиентов по городам (см. рис. 10.1). Вы можете использовать эту таблицу для формирования отчета или представленияданных в виде диаграммы. 
  </li>
</ol>
<p>&nbsp;
<a NAME="3"></a><font size="4">Двумерные перекрестные таблицы </font>
</P>
<P>
Информация в двумерных перекрестных таблицах группируется по двумфакторам. Примером такой таблицы является Saiegoods, представленная нарис. 10.2. Она содержит сведения о стоимости проданных товаров по городам. Данная таблица была получена из таблиц customer, ordsaiem иordsaied с помощью многотабличного запроса. Для наглядности результирующим полям запроса присвоены русскоязычные названия.
</P>
<P>
SELECT Customer.cCity AS Город, Ordsaied.icdGoods AS Код_товара,;
</P>
<P>
SUM{Ordsaied.nQuant*Ordsaled.nUnitprice) AS Сумма;</P>
<P>
FROM Sales!Customer INNER JOIN Sales!Ordsaiem;
</P>
<P>
INNER JOIN Sales!Ordsaied ;</P>
<P>
ON Ordsaiem.icdOrder = Ordsaied.icdOrder ;</P>
<P>
ON Customer.icdCustomer = Ordsaiem.icdCustomer;</P>
<P>
GROUP BY Customer.cCity, Ordsaied.icdGoods;</P>
<P>
INTO TABLE saleGoods.dbf
</P>
<P>
В таблице, представленной на рис. 10.2, отображается вся необходимая информация о продажах товаров, однако более удобным для анализа являетсяпредставление этой информации в виде перекрестной таблицы. На рис. 10.3представлена двумерная перекрестная таблица, созданная на основе таблицы
Saiegoods.
</P>
<IMG src="gl10-2.jpg" alt="gl10-2.jpg" width="500" height="395"></IMG>
<P>
Рис. 10.2. Таблица Salegoods
</P>
<IMG src="gl10-3.jpg" alt="gl10-3.jpg" width="500" height="279"></IMG>
<P>
Рис. 10.3. Двумерная перекрестная таблица
</P>
<P>
Числа в ячейках таблицы соответствуют стоимости проданного товара длякаждой пары уникальных значений &quot;код товара/город&quot;. Значения поля, содержащего наименование города, расположены в верхней строке таблицы, азначения поля, обозначающего код проданного товара, — в левом столбцетаблицы. Сохраните таблицу с именем salereg. Ее можно будет использовать при создании трехмерных диаграмм.
</P>
<p>&nbsp;
<a NAME="4"></a><font size="4">Создание перекрестной таблицыс помощью мастера </font>
</P>
<P>
В Visual FoxPro для создания перекрестной таблицы можно использоватьмастер Cross-Tab Wizard (Мастер построения перекрестных таблиц). В появляющемся после запуска мастера диалоговом окне необходимо указать исходную таблицу, которая может быть таблицей из базы данных или являтьсярезультатом выборки данных из нескольких таблиц. Мастер на основе исходной таблицы создает итоговую выборку, в которой группирует и сортирует данные по полям, используемым в качестве строки и столбца перекрестной таблицы, а также вычисляет суммарное значение по заданному полюданных. Затем Visual FoxPro вызывает программу vfpxtab.prg, наименование которой хранится в системной переменной _GENXTAB.
</P>
<P>
Чтобы продемонстрировать возможности мастера по созданию перекрестнойтаблицы, воспользуемся таблицей Salegoods.
</P>
<P>
Для создания перекрестной таблицы с помощью мастера выполните следующие действия:
</P>
<ol>
  <li>В меню File (Файл) выберите команду New (Новый). </li>
  <li>В диалоговом окне New (Новый) выберите тип создаваемого объектаQuery (Запрос) и нажмите кнопку Wizard (Мастер). 
  </li>
  <li>Из диалогового окна Wizard Selection (Выбор мастера) запустите мастерсоздания перекрестной таблицы, выбрав Cross-Tab Wizard (Мастер построения перекрестных таблиц). 
  </li>
</ol>
<P>
<b>
<font color="#008000">Замечание</font></b></P>
<P>
<font color="#008000">Для запуска мастера по созданию перекрестной таблицы можно также в менюTools (Сервис) выбрать команду Wizard (Мастер), а затем — значение Query(Запрос). При этом открывается диалоговое окно Wizard Selection (Выбор мастера).
</font>
</P>
<ol>
  <li value="4">В первом окне мастера (рис. 10.4) выберите исходную таблицу Salegoodsи все три поля, которые будут использоваться в качестве строки, столбцаи поля данных перекрестной таблицы. Для перехода к следующему шагунажмите кнопку Next (Далее). 
  </li>
</ol>
<IMG src="gl10-4.jpg" alt="gl10-4.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.4. Выбор исходной таблицы и полей
</P>
<ol>
  <li value="5">На втором шаге в работе мастера (рис. 10.5) необходимо указать расположение полей в создаваемой перекрестной таблице. Вам предлагаетсяразместить поля таблицы в трех полях диалогового окна. Для перемещения полей используйте метод &quot;перенести-и-оставить&quot;. 
  </li>
</ol>
<IMG src="gl10-5.jpg" alt="gl10-5.jpg" width="500" height="371"></IMG>
<P>
Рис. 10.5. Определение строк, столбцов и поля данных
</P>
<P>
Перенесите поле город в область Column (Колонка), поле код_товара —в область Row (Ряд) и поле сумма — в область Data (Данные). Послеэтого диалоговое окно будет выглядеть так, как показано на рис. 10.6.Нажмите кнопку Next (Далее) для перехода к следующему шагу.
</P>
<IMG src="gl10-6.jpg" alt="gl10-6.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.6. Диалоговое окно после определения строк,столбцов и поля данных
</P>
<ol>
  <li value="6">В следующем диалоговом окне Cross-Tab Wizard (Мастер построения перекрестных таблиц) (рис. 10.7) содержится группа переключателей Summary(Итог), позволяющая вычислять групповые значения по полю (табл. 10.1). 
  </li>
</ol>
<P>
Таблица 10.1. Назначение группы переключателей Summaryдиалогового окна Cross-Tab Wizard  Step 3
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Переключатель

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Назначение

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Sum (Сумма)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые значения равны сумме значений для каждой парыстрока/столбец

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Count
(Количество)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые значения равны количеству значений для каждойпары строка/столбец

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Average
(Среднее)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые значения равны среднему значению для каждойпары строка/столбец

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Мах (Наибольшее)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые значения равны наибольшему из всех значений длякаждой пары строка/столбец

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Min (Наименьшее)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые значения равны наименьшему из всех значенийдля каждой пары строка/столбец

</TD>
</TR>
</TABLE>
<P>
<b>Установите опцию Sum. </b>
</P>
<ol>
  <li value="7">На третьем шаге в работе мастера вы можете добавить столбец в создаваемую перекрестную таблицу, который будет содержать итоговое значение по каждой строке результирующей таблицы (см. рис. 10.7). Мастерпозволяет выбрать один из переключателей группы Subtotals (табл. 10.2). 
  </li>
</ol>
<IMG src="gl10-7.jpg" alt="gl10-7.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.7. Определение типа группировки и итогового столбца
</P>
<P>
Таблица 10.2. Назначение группы переключателей Subtotalsдиалогового окна Cross-Tab Wizard  Step 3
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Переключатель

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Назначение

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Sum of data (Сумма данных)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые  значения  равны сумме  значений  длятекущей строки

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Number of cells containingdata (Число ячеек, содержащих данные)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые значения равны количеству ячеек, содержащих значения

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Percentage of the table total
(Процент от итоговой суммы)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговые  значения  равны сумме  значений  длятекущей строки, выраженной в процентах по отношению к итоговой сумме

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

None (Нет)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Итоговый столбец не создается

</TD>
</TR>
</TABLE>
<P>
Установите опцию Percentage of the table total (Процент от итоговой суммы). Для перехода к завершающей стадии создания перекрестной таблицы нажмите кнопку Next (Далее).
</P>
<ol>
  <li value="8">На последнем шаге работы мастера (рис. 10.8) вы можете просмотретьрезультаты, 
нажав кнопку Preview (Просмотр). Воспользуйтесь этой возможностью и убедитесь, что правильно установили все параметры. 
  </li>
  <li>Установите в завершающем окне мастера одну из опций, описанных втабл. 10.3. 
  </li>
</ol>
<P>
Выберите третий вариант и нажмите кнопку Finish (Готово). Мастер завершит работу и откроет созданный запрос в окне конструктора. Просмотрите
SQL-оператор. Для этого в меню Query (Запрос) выберите команду ViewSQL (Показать SQL).
</P>
<IMG src="gl10-8.jpg" alt="gl10-8.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.8. Завершающая стадия создания перекрестной таблицы
</P>
<P>
Таблица 10.3. Назначение переключателей диалогового окна
Cross-Tab Wizard  Step 4
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Переключатель

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Назначение

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Save cross-tab query (Сохранить перекрестную таблицу в запросе)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Мастер сохраняет созданный запрос

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Save and run cross-tab query (Сохранитьперекрестную таблицу в запросе и запустить)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Мастер сохраняет созданный запроси запускает его на выполнение

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Save cross-tab query and modify in theQuery Designer (Сохранить перекрестнуютаблицу 
и открыть для модификации в конструкторе запросов)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Мастер сохраняет созданный запроси открывает его в окне конструкторазапросов

</TD>
</TR>
</TABLE>
<P>
Запрос, созданный с помощью мастера, содержит конструкцию для выборкиданных, вызов программы, формирующей перекрестную таблицу, и командупросмотра таблицы в режиме Browse (Просмотр):
</P>
<P>
SELECT SaleGoods.Код_товара, SaleGoods .Город, SUM(SaleGoods.Сумма);</P>
<P>
FROM 'SaleGoods.DBF' SaleGoods;</P>
<P>
GROUP BY SaleGoods.Код_товара, SaleGoods.Город;</P>
<P>
ORDER BY SaleGoods.Код_товара, SaleGoods.Город;
</P>
<P>
INTO CURSOR SYS(2015)</P>
<P>
DO (_GENXTAB) WITH 'Query',.t.,.t.,.t.,;, ,.t.,0,.t.
</P>
<P>
BROWSE NOMODIFY
</P>
<P>
Результат запроса аналогичен приведенному на рис. 10.3.
</P>
<p>&nbsp;
<a NAME="5"></a><font size="4">Программа создания перекрестной таблицы </font>
</P>
<P>
Мастер перекрестных таблиц использует в своей работе программуVFPXTAB.PRG. Эту программу вы можете вызывать из ваших программ,предварительно подготовив и открыв в текущей области требуемую таблицу.
</P>
<P>
Для работы программы, создающей перекрестную таблицу, необходимо определить используемые в ней параметры (табл. 10.4).
</P>
<P>
Таблица 10.4. Параметры программы, создающей перекрестные таблицы
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Порядковыйномерпараметра

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Назначение

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Значениепо умолчанию

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

1

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Имя выходного файла или курсора

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

xtab.dbf

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

2

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Признак создания только курсора

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

True

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

3

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Признак закрытия исходной таблицы при выходе изпрограммы

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

True

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

4

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Признак отображения индикатора работы программы

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

True

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

5

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Номер   поля,   являющегося   строкой   перекрестнойтаблицы

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

1

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

6

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Номер поля, являющегося столбцом перекрестнойтаблицы

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

2

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

7

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Номер поля, являющегося полем данных перекрестной таблицы

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

3

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

8

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Признак формирования итогового поля

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

False

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

9

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Тип вычисления итогового поля (0 — сумма, 1 — количество, 2 — доля от итогового значения в процентах)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">



&nbsp;&nbsp;



</TD>
</TR>
</TABLE>
<P>
Воспользуемся  программой  VFPXTAB.PRG для  представления  итоговогообъема продаж товара по месяцам в виде перекрестной таблицы.
</P>
<ol>
  <li>В окне конструктора запросов создайте запрос, используя таблицыOrdsaiem и 
Ordsaied. Разместите в итоговых полях код товара, месяц продажи и стоимость проданного товара. Установите группировку данных покоду товара, месяцу продажи и упорядочение данных по коду товара. 
  </li>
  <li>Просмотрите созданный запрос и убедитесь, что он правильно осуществляет выборку данных из таблиц. 
  </li>
  <li>Откройте диалоговое окно, в котором отображается SQL-оператор, соответствующий созданному вами запросу. Для этого в меню Query (Запрос)выберите команду View SQL (Показать SQL). 
  </li>
  <li>&nbsp;Скопируйте SQL-оператор в буфер обмена Windows. </li>
  <li>Откройте новое окно редактора программ. Для этого перейдите на вкладку Code 
(Код) конструктора проекта, установите курсор в группу Programs (Программы) и нажмите кнопку New (Новый). 
  </li>
  <li>В открывшемся окне новой программы разместите из буфера обменаконструкцию SELECT, определяющую итоговые ежемесячные продажи. 
  </li>
  <li>Добавьте в вашу программу вызов программы генерации перекрестнойтаблицы: 
  </li>
</ol>
<blockquote>
<P>
SELECT SaleMon
</P>
<P>
DO (_GENXTAB) WITH 'SMon',.F.,.T.,.T.,,,, .T.,2
</P>
</blockquote>
<P>
После размещения в программе всех необходимых команд она будетиметь вид, представленный на рис. 10.9.
</P>
<IMG src="gl10-9.jpg" alt="gl10-9.jpg" width="500" height="346"></IMG>
<P>
Рис. 10.9. Завершающая стадия создания перекрестной таблицы
</P>
<ol>
  <li value="8">Сохраните программу с именем Salemon.prg и запустите ее на выполнение. Будет создана таблица smon с ежемесячными итоговыми объемамипродаж товаров (рис. 10.10). 
  </li>
</ol>
<IMG src="gl10-10.jpg" alt="gl10-10.jpg" width="500" height="376"></IMG>
<P>
Рис. 10.10. Итоговые ежемесячные объемы продаж товаров
</P>
<P>
<b>
<font color="#800000">Совет</font></b></P>
<P>
<font color="#800000">При создании выборки вы можете для определения имени месяца вместо егономера использовать подготовленную заранее функцию. Однако в этом случаепри упорядочении выборки по месяцам в перекрестной таблице названия месяцев будут расположены в алфавитном, а не в хронологическом порядке.
</font>
</P>
<p>&nbsp;
<a NAME="6"></a><font size="4">Экспорт данных </font>
</P>
<P>
Созданную в Visual FoxPro перекрестную таблицу вы можете использовать впрограммах управления электронными таблицами, таких как Microsoft Excel,Lotus 1-2-3 и т. д. Для этого вы должны ее экспортировать в формат той электронной таблицы, в которой будет осуществляться дальнейшая обработка.
</P>
<P>
Для экспорта данных предназначена команда Export (Экспорт) из меню File(Файл). В результате выполнения этой команды открывается диалоговое 
окно Export (Экспорт) (рис. 10.11), в котором вы должны указать исходнуютаблицу, 
задать формат данных, имя выходного файла, а затем нажать кнопку ОК.
</P>
<IMG src="gl10-11.jpg" alt="gl10-11.jpg" width="390" height="186"></IMG>
<P>
Рис. 10.11. Диалоговое окно Export
</P>
<p>&nbsp;
<a NAME="7"></a><font size="4">Построение диаграмм </font>
</P>
<P>
Для визуального анализа данных, хранящихся в таблицах Visual FoxPro, выможете использовать диаграммы.
</P>
<P>
В распоряжение разработчика Visual FoxPro предоставляет двенадцать типовдиаграмм. Вам необходимо правильно определиться с ее типом, т. к. одну иту же информацию можно представить с помощью диаграмм разных типов.
</P>
<P>
Для построения диаграмм в Visual FoxPro используется программа MicrosoftGraph, данные в которую передаются с помощью мастера построения диаграмм или с использованием приложения WZGRAPH.APP.
</P>
<p>&nbsp;
<a NAME="8"></a><font size="4">Создание диаграммы с помощьюмастера Graph Wizard </font>
</P>
<P>
Для построения диаграммы воспользуемся одномерной перекрестной таблицей CNTCUST, отображающей распределение клиентов по городам. О нейупоминалось в начале данной главы.
</P>
<P>
На первом шаге создания диаграммы с помощью мастера указывается таблица, для которой строится диаграмма. Это может быть таблица из базыданных или выборка из нескольких таблиц. После выбора полей, используемых при создании диаграммы, вызывается приложение WZGRAPH.APP.Это приложение передает выбранные данные в Microsoft Graph 
и на их основе создается диаграмма указанного вами типа.
</P>
<P>
Рассмотрим создание диаграммы с помощью мастера более подробно.
</P>
<ol>
  <li>В меню File (Файл) выберите команду New (Новый). </li>
  <li>В диалоговом окне New (Новый) укажите тип создаваемого объекта Query(Запрос) и нажмите кнопку Wizard (Мастер). 
  </li>
  <li>Из диалогового окна Wizard Selection (Выбор мастера) запустите мастерасоздания диаграммы, выбрав значение Graph Wizard (Мастер диаграмм). 
  </li>
  <li>На первом шаге работы мастера выберите исходную таблицу CNTCUST иполя, которые будут использоваться при создании диаграммы(рис. 10.12). Рассматриваемая исходная таблица содержит всего два поля.Выберите их. 
  </li>
</ol>
<P>
<b>
<font color="#800000">Совет</font></b></P>
<P>
<font color="#800000">Если исходная таблица содержит много полей, вы можете ограничить количество выбираемых полей, т. к. при большом количестве полей диаграмма получается недостаточно наглядной и ее трудно анализировать.
</font>
</P>
<IMG src="gl10-12.jpg" alt="gl10-12.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.12. Выбор исходной таблицы и полей
</P>
<P>
Завершив выбор полей, нажмите кнопку Next (Далее).5.  В следующем диалоговом окне мастера (рис. 10.13) выполните действия:
</P>
<ul>
  <li>укажите поле, содержащее названия городов, значения которого будутиспользоваться в категориях диаграммы; 
  </li>
  <li>укажите поле, содержащее количество клиентов, значения которогобудут использоваться в рядах данных. 
  </li>
</ul>
<P>
Для этого перенесите поле город исходной таблицы в область Axis (Ось),а поле количество — в область Data Series (Ряд данных) диалогового 
окна. Затем нажмите кнопку Next (Далее).
</P>
<IMG src="gl10-13.jpg" alt="gl10-13.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.13. Определение категории и рядов данных
</P>
<ol>
  <li value="6">На следующем шаге вы должны указать тип создаваемой диаграммы(рис. 10.14), выбрав значение из предложенных вариантов. В данномпримере выберите гистограмму. Для перехода к следующему шагу нажмите кнопку Next (Далее). 
  </li>
</ol>
<IMG src="gl10-14.jpg" alt="gl10-14.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.14. Определение типа диаграммы
</P>
<ol>
  <li value="7">В последнем диалоговом окне мастера (рис. 10.15) введите заголовокдиаграммы и установите флажок добавления в диаграмму легенд (то естьусловных 
обозначений рядов данных). Используя кнопку Preview(Просмотр), просмотрите 
результат своей работы. Еще не поздно вернуться к предыдущим шагам в работе мастера и изменить установленныетам параметры. После этого, используя расположенные в окне переключатели (табл. 10.5), укажите дальнейшие ваши действия. 
  </li>
</ol>
<P>
Таблица 10.5. Назначение переключателей диалогового окна Graph Wizard  Step 4
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Переключатель

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Назначение

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Save graph to a form (Сохранитьдиаграмму в форме)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Сохраняет созданную диаграмму в форме

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Save graph to a table (Сохранитьдиаграмму в таблице)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Сохраняет созданную диаграмму в таблице,содержащей поле типа General

</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD ALIGN="LEFT" VALIGN="TOP">

Create a query that produces thegraph (Сохранить и создать длядиаграммы запрос)

</TD>
<TD ALIGN="LEFT" VALIGN="TOP">

Сохраняет созданный запрос и открывает егов окне конструктора запросов

</TD>
</TR>
</TABLE>
<P>
Выберите третий вариант и нажмите Finish (Готово). Мастер сохранит запрос с 
заданным именем и откроет окно конструктора с созданным запросом. Тело запроса 
содержит конструкцию SELECT и команду вызоваприложения создания диаграммы.</P>
<IMG src="gl10-15.jpg" alt="gl10-15.jpg" width="492" height="360"></IMG>
<P>
Рис. 10.15. Завершающая стадия создания диаграммы
</P>
<ol>
  <li value="8">Запустите запрос на выполнение. </li>
  <li>Снова вызывается мастер построения диаграмм, предлагая повторитьшаги с третьего по пятый. На завершающей стадии построения диаграммы задайте ее заголовок, нажмите кнопку Finish (Готово) и введите имяформы, в которой будет храниться созданная диаграмма. После этогомастер вызывает программу Microsoft Graph, в которую передает результаты выборки и параметры диаграммы. На рис. 10.16 показана созданнаядиаграмма. 
  </li>
</ol>
<P>
Диаграмма сохранена в форме. Вы можете открыть форму, изменить типдиаграммы или отформатировать ее элементы. Для подробного ознакомления с этими возможностями обратитесь к справочной системе MicrosoftGraph или руководству пользователя.
</P>
<P>
Чтобы перейти в режим редактирования диаграммы, выделите диаграмму ивыберите из контекстного меню команду Chart Object (Объект &quot;диаграмма&quot;),а затем команду Edit (Правка). Теперь вы можете приступить к изменениюее параметров.
</P>
<IMG src="gl10-17.jpg" alt="gl10-17.jpg" width="500" height="445"></IMG>
<P>
Рис. 10.16. Диаграмма распределения клиентов по городам
</P>
<IMG src="gl10-18.jpg" alt="gl10-18.jpg" width="500" height="445"></IMG>
<P>
Рис. 10.17. Круговая диаграмма распределения клиентов по городам
</P>
<P>
<b>
<font color="#008000">Замечание</font></b></P>
<P>
<font color="#008000">В режиме редактирования можно настраивать самые разнообразные параметры диаграммы: формат отображения данных, заголовок диаграммы, надписиосей, параметры сетки, шрифт, формат выводимых значений и т. п.
</font>
</P>
<P>
Созданная нами диаграмма является одномерной. Для исходной таблицы выможете также построить круговую диаграмму, которая позволяет увидетьотносительный вклад каждой из величин в итоговое значение (рис. 10.17).Каждому элементу данных на диаграмме соответствует сектор круга, а суммарному значению — весь круг.
</P>
<p>&nbsp;
<a NAME="9"></a><font size="4">Создание трехмерных диаграмм </font>
</P>
<P>
Таблица CNTCUST содержит всего одно числовое поле, поэтому диаграмма,показанная на рис. 10.17, представляет собой простейшую диаграмму. Дляпостроения более сложной диаграммы обратимся к перекрестной таблице
SALEREG.
</P>
<IMG src="gl10-19.jpg" alt="gl10-19.jpg" width="500" height="445"></IMG>
<P>
Рис. 10.18. Трехмерная диаграмма,построенная для таблицы SALEREG
</P>
<P>
Для создания диаграммы выполните следующие действия:
</P>
<ol>
  <li>Запустите мастера создания диаграммы Graph Wizard (Мастер диаграмм). </li>
  <li>На первом шаге выберите таблицу SALEREG и поля, содержащие код товараи объемы продаж по городам. Чтобы диаграмма была более наглядной, ограничьтесь выбором нескольких городов. Нажмите кнопку Next (Далее). 
  </li>
  <li>Перенесите поле, содержащее наименование города, в область Axis (Ось),а объемы продаж по городам — в Data Series (Ряд данных). 
  </li>
  <li>Укажите тип создаваемой диаграммы и нажмите кнопку Next (Далее) дляперехода к завершающей стадии создания диаграммы с помощью мастера. 
  </li>
  <li>Введите заголовок диаграммы: Продажи по городам. </li>
</ol>
<P>
Созданная диаграмма будет иметь вид, представленный на рис. 10.18.
</P>
</BODY>
</HTML>