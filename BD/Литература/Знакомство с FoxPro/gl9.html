<HTML>
<HEAD>
<TITLE></TITLE>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=WINDOWS-1251">
</HEAD>
<body background="../fon.jpg">

<p><CENTER><font size="4"><b>ГЛАВА 9 
<br>
Запросы к базе данных</b></font>
</center>
</P>
<br>
<br>

<ul>
  <li><a href="gl9.html#1">Конструктор запросов</a>
  <li><a href="gl9.html#2">Команды, используемые при формировании запросов</a>
  <li><a href="gl9.html#3">Сохранение запроса</a>
  <li><a href="gl9.html#4">Запуск запроса на выполнение</a>
  <li><a href="gl9.html#5">Формирование списка полей результирующей таблицы запроса</a>
  <li><a href="gl9.html#6">Вычисляемые поля запроса</a>
  <li><a href="gl9.html#7">Вкладка Order By конструктора запросов</a>
  <li><a href="gl9.html#8">Упорядочение по нескольким полям</a>
  <li><a href="gl9.html#9">Задание условий для выбора записей</a>
  <li><a href="gl9.html#10">Задание условия точного совпадения значений одного поля</a>
  <li><a href="gl9.html#11">Выбор полей, не удовлетворяющих заданному условию</a>
  <li><a href="gl9.html#12">Выбор похожих значений</a>
  <li><a href="gl9.html#13">Выбор записей, находящихся в заданном диапазоне значений</a>
  <li><a href="gl9.html#14">Формирование списка условий </a>
  <li><a href="gl9.html#15">Многотабличные запросы</a>
  <li><a href="gl9.html#16">Выборка из четырех таблиц </a>
  <li><a href="gl9.html#17">Группировка полей запроса</a>
  <li><a href="gl9.html#18">Использование в запросе выражений и функций полей</a>
  <li><a href="gl9.html#19">Включение в запрос итоговых значений</a>
  <li><a href="gl9.html#20">Изменение наименований полей в запросе</a>
</ul>
<P>
Одним из основных назначений разработанного приложения является быстрый поиск информации в базе данных и получение ответов на разнообразные вопросы. Для этих целей в Visual FoxPro используются средства, называемые запросами. 
</P>
<P>
Например, вам необходимо выбрать из таблиц информацию о клиентах, проживающих в Москве и Московской области, или сформировать список клиентов, купивших в последний месяц товаров на сумму свыше 5000 рублей, и упорядочить их в алфавитном порядке по полю, содержащему фамилии клиентов. Для решения таких задач предназначен конструктор запросов и команда SELECT языка Visual FoxPro. 
</P>
<P>
С помощью конструктора запросов Visual FoxPro вы можете формировать различной сложности критерии для выбора записей из одной или нескольких таблиц, указывая при этом, какие поля должны быть отображены в запросе. Над полями, выбираемыми из таблиц с помощью запросов, можно выполнять различные вычисления. 
</P>
<P>
<IMG src="gl9-1.jpg" alt="gl9-1.jpg" ></P>
<P>
Рис. 9.1. Ввод условия выборки в мастере запросов 
</P>
<P>
Результатом запроса является таблица, которую вы можете сохранить в массиве, в создаваемой новой таблице, отобразить на экране в режиме Browse (Просмотр) или вывести в виде отчета. </IMG>&nbsp;</P>
<P>
Для создания запросов вы можете использовать мастер запросов, который последовательно 
запрашивает наименования таблиц, используемых в запросе, перечень полей таблиц, 
критерий упорядочения и условия фильтрации данных. На рис. 9.1 приведено диалоговое окно мастера, позволяющее сформировать условия фильтрации выбираемых из таблицы данных. Мы не будем рассматривать создание запросов с помощью мастера, т. к. конструктор запросов достаточно прост и работа в нем у вас не вызовет затруднений. 
</P>
<p>&nbsp;
<a NAME="1"></a><font size="4">Конструктор запросов </font> 
</P>
<P>
Для создания запроса в окне конструктора запросов выполните следующие действия: 
</P>
<ol>
  <li>На вкладке Data (Данные) конструктора проекта выберите группу Queries (Запросы). 
  </li>
  <li>Нажмите кнопку New (Новый). </li>
  <li>В открывшемся диалоговом окне New Query (Новый запрос) нажмите кнопку New Query (Новый запрос). Открывается диалоговое окно выбора таблиц Add Table or View (Добавить таблицу или представление данных). 
  </li>
  <li>В этом диалоговом окне выберите таблицы, данные из которых хотите использовать в запросе, и с помощью кнопки Add (Добавить) перенесите их в окно конструктора запросов. 
  </li>
  <li>Завершив выбор таблиц, нажмите кнопку Close (Закрыть). </li>
</ol>
<P>
На экране появляется окно конструктора запросов (рис. 9.2), которое содержит названия выбранных таблиц, а в основном меню появляется пункт Query (Запрос). Можно приступать к формированию условий запроса. 
</P>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">Для открытия ранее созданного запроса в окне конструктора запросов на вкладке Data (Данные) окна проекта в группе Queries (Запросы) найдите модифицируемый запрос, установите на него курсор и нажмите кнопку Modify (Модифицировать).
</font> 
</P>
<P>
Далее, открывая в конструкторе запросов необходимые вкладки, вы выполняете следующие действия: 
</P>
<ul>
  <li>выбираете поля результирующей таблицы запроса; </li>
  <li>формируете вычисляемые поля; </li>
  <li>указываете критерии для выборки, группировки и упорядочения данных; </li>
  <li>задаете, куда выводить результат выборки. </li>
</ul>
<P>
В верхней части окна конструктора запросов расположена панель, на которой 
отображаются используемые в запросе таблицы. Ниже находятся вкладки, предназначенные для выбора полей запроса и формирования условий выборки. Назначение этих вкладок приведено в табл. 9.1. 
</P>
<IMG src="gl9-2.jpg" alt="gl9-2.jpg" ></IMG>
<P>
Рис. 9.2. Окно конструктора запросов с выбранной таблицей клиентов 
</P>
<P>
Таблица 9.1. Назначение вкладок окна конструктора запросов 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Вкладка 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Fields (Поля) 
</TD>
<TD VALIGN="TOP">
Позволяет указать поля исходных таблиц, выбираемые в результирующий запрос 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Join (Объединение) 
</TD>
<TD VALIGN="TOP">
Позволяет задать условия объединения таблиц 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Filter (Фильтр) 
</TD>
<TD VALIGN="TOP">
Позволяет определить фильтры, накладываемые для выбора записей 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Order By
(Упорядочение) 
</TD>
<TD VALIGN="TOP">
Позволяет задать критерии упорядочения данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Group By
(Группировка) 
</TD>
<TD VALIGN="TOP">
Позволяет задать условия группировки данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Miscellaneous
(Разное) 
</TD>
<TD VALIGN="TOP">
Позволяет задать дополнительные условия, такие как признак выборки повторяющихся значений, количество или процент выбора данных 
</TD>
</TR>
</TABLE>
<p>&nbsp;
<a NAME="2"></a><font size="4">Команды, используемые при формировании запросов </font> 
</P>
<P>
Для работы в окне конструктора запроса можно использовать команды меню Query и панель инструментов Query Designer (Конструктор запроса). Назначение команд и кнопок на панели инструментов описано в табл. 9.2. 
</P>
<P>
Таблица 9.2. Назначение команд меню Query и кнопок панели инструментов Query Designer 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Команда меню 
</TD>
<TD VALIGN="TOP">
Кнопка 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Add Table (Добавить таблицу) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Добавляет в запрос новую таблицу 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Remove Table (Удалить таблицу) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Удаляет выбранную таблицу из запроса 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Remove Join Condition
(Удалить условие объединения) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Удаляет условие объединения таблиц 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Output Fields
(Результирующие поля) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Открывает вкладку Fields для выбора полей результирующей таблицы 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Join (Объединение) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Открывает вкладку Join для задания условия объединения таблиц 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Filter (Фильтр) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Открывает   вкладку   Filter   для    задания фильтра 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Order By (Упорядочение) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Открывает вкладку Order By для определения критерия упорядочения 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Group By (Группировка) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Открывает вкладку Group By для определения условия группировки данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Miscellaneous (Разное) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Открывает вкладку Miscellaneous для задания дополнительных параметров запроса 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Query Destination (Результат запроса) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Открывает диалоговое окно Query Destination, в котором указывается, куда выводить результат запроса 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
View SQL (Показать SQL) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Открывает диалоговое окно, в котором отображается SQL-оператор, соответствующий созданному запросу 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Maximize the table view
(Максимизировать панель отображения) 
</TD>
<TD VALIGN="TOP">
</P>
</TD>
<TD VALIGN="TOP">
Раскрывает   панель   отображения   используемых в запросе таблиц на весь экран. Повторное нажатие на эту кнопку возвращает панели первоначальный размер 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Add Join (Добавить условие объединения) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Открывает диалоговое окно Join Condition
для задания условия объединения таблиц 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Comments (Комментарии) 
</TD>
<TD VALIGN="TOP">
&nbsp;</TD>
<TD VALIGN="TOP">
Открывает диалоговое окно, в котором вы можете   ввести   краткое  описание  создаваемого запроса 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Run Query (Выполнить запрос) 
</TD>
<TD VALIGN="TOP">
— 
</TD>
<TD VALIGN="TOP">
Запускает запрос на выполнение 
</TD>
</TR>
</TABLE>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">Для просмотра конструкции SELECT, соответствующей выборке, предназначены 
команда View SQL и кнопка Show the SQL window панели инструментов. Сформировав 
запрос, вы можете скопировать конструкцию SELECT во временный буфер Windows и использовать ее при написании программ.
</font> 
</P>
<p>&nbsp;
<a NAME="3"></a><font size="4">Сохранение запроса </font> 
</P>
<P>
Сформировав в окне конструктора запросов условия выборки, вы можете их сохранить в файле с расширением QPR, что позволит сэкономить время при последующих запусках запроса. 
</P>
<P>
Для сохранения условий выборки в меню File (Файл) выберите команду Save as (Сохранить как). В открывшемся диалоговом окне Save As (Сохранить как) откройте папку, в которой хотите сохранить файл, введите в поле ввода имя файла и нажмите кнопку Сохранить. 
</P>
<P>
В окне проекта запросы размещаются в разделе Queries (Запросы) вкладки Data (Данные). Для открытия запроса необходимо установить на него курсор и нажать кнопку Modify (Модифицировать) окна проекта. 
</P>
<p>&nbsp;
<a NAME="4"></a><font size="4">Запуск запроса на выполнение </font> 
</P>
<P>
После задания условий для выбора записей и указания результирующих полей в окне конструктора вы можете просмотреть результаты выполнения запроса. Для этого выполните одно из следующих действий: 
</P>
<ul>
  <li>нажмите кнопку Run (Выполнить) на стандартной панели инструментов; </li>
  <li>выберите команду контекстного меню Run Query (Выполнить запрос); </li>
  <li>выберите в меню Query (Запрос) команду Run Query (Выполнить запрос); </li>
  <li>нажмите комбинацию клавиш &lt;Ctrl&gt;+&lt;Q&gt;. </li>
</ul>
<P>
На экране появятся результаты запроса, представленные в табличном виде. 
</P>
<P>
Для просмотра результатов запроса, не открытого в окне конструктора запросов, необходимо в окне проекта установить курсор на имя запроса и нажать кнопку Run (Выполнить). 
</P>
<p>&nbsp;
<a NAME="5"></a><font size="4">Формирование списка полей результирующей таблицы запроса </font> 
</P>
<P>
В результирующей таблице запроса поля формируются на основе полей исходных таблиц и вычисляемых полей. Для задания списка полей результирующей таблицы запроса предназначена вкладка Fields (Поля) конструктора запросов (рис. 9.3). 
</P>
<IMG src="gl9-3.jpg" alt="gl9-3.jpg" ></IMG>
<P>
Рис. 9.3. Вкладка Fields предназначена для выбора полей запроса 
</P>
<P>
Вкладка Fields (Поля) содержит два списка: Available fields (Имеющиеся поля) и Selected fields (Выбранные поля). Список Available fields (Имеющиеся
поля) содержит все поля размещенных в окне конструктора таблиц. Selected fields (Выбранные поля) отображает поля формируемого запроса. 
</P>
<P>
Перенести поля из списка Available fields (Имеющиеся поля) в Selected fields
(Выбранные поля) вы можете одним из следующих способов. 
</P>
<ul>
  <li>Использовать для переноса кнопки Add (Добавить) и Add All (Добавить все), позволяющие перенести в список Selected fields (Выбранные поля) выделенные или все поля, соответственно. Используя кнопку Remove (Удалить), вы можете вернуть в список Available fields (Имеющиеся поля) ошибочно перенесенные поля. 
  </li>
  <li>Использовать механизм &quot;перенести-и-оставить&quot;. Для этого на панели, 
  содержащей образы используемых в запросе таблиц, выделите поля, которые вы собираетесь отобразить в запросе, нажмите кнопку мыши и, не отпуская ее, перенесите их в список Selected fields (Выбранные поля). Для выбора всех полей используется строка таблицы, содержащая звездочку. Этот же механизм можно использовать для удаления полей из списка Selected fields (Выбранные поля). 
  </li>
  <li>Для переноса поля из списка Available fields (Имеющиеся поля) в Selected fields (Выбранные поля) вы можете дважды щелкнуть мышью на поле в образе таблицы или в списке Available fields (Имеющиеся поля). 
  </li>
</ul>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">Как и при работе с объектами в Windows, для выделения группы полей вы можете использовать мышь совместно с клавишами &lt;Shift&gt; и &lt;Ctrl&gt;. Сначала выделите первое из выбираемых полей и нажмите клавишу &lt;Shift&gt; или &lt;Ctrl&gt; в зависимости от того, расположены выбираемые поля рядом или вразброс. Затем, не отпуская клавишу, щелкните мышью по крайнему полю из группы подряд выбираемых полей или по каждому из отдельно расположенных полей.
</font> 
</P>
<P>
Поля в результирующей таблице запроса будут следовать в том порядке, в котором 
они расположены в списке Selected fields (Выбранные поля). Для изменения 
расположения полей в этом списке можно использовать находящийся слева от поля маркер перемещения. Установите курсор на маркер и переместите поле в требуемую строку. 
</P>
<p>&nbsp;
<a NAME="6"></a><font size="4">Вычисляемые поля запроса </font> 
</P>
<P>
Visual FoxPro позволяет включать в результирующую таблицу запроса не только информацию из исходных таблиц, но и производить вычисления над ними, позволяя, таким образом, получить данные, отсутствующие в исходной таблице. Например, из базы данных, предназначенной для учета междугородних разговоров, вы можете выбрать поля таблиц с продолжительностью разговора и стоимостью одной минуты. На основании этой информации вы можете получить в запросе сведения о стоимости разговоров. 
</P>
<P>
Кроме того, вы можете использовать вычисляемые поля для объединения нескольких полей исходной таблицы в одно результирующее поле. Например, 
таблица customer содержит фамилию, имя и отчество клиента. В результирующий 
запрос вы можете поместить одно поле, в котором будет размещена фамилия и инициалы клиента. 
</P>
<P>
Для формирования выражения предназначено поле Functions and expressions (Функции и выражения) вкладки Fields (Поля). Нажмите расположенную справа от поля кнопку вызова построителя выражения и в диалоговом окне Expression Builder (Построитель выражения) создайте выражение для вычисляемого поля. После того как выражение в поле Functions and expressions (Функции и выражения) сформировано, нажатием кнопки Add (Добавить) перенесите его в список Selected fields (Выбранные поля). 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">В окне Expression Builder (Построитель выражения) при создании выражения вы можете использовать поля исходных таблиц, константы, функции. Используя круглые скобки, вы можете изменить порядок вычисления или сгруппировать данные.
</font> 
</P>
<P>
Используя данные из таблицы Customer, создадим запрос, результирующая таблица которого будет содержать название предприятия и полный адрес клиента с учетом города. 
</P>
<ol>
  <li>Откройте окно запроса для таблицы customer. </li>
  <li>На вкладке Fields (Поля) перенесите в список Selected fields (Выбранные поля) поле ccompany, содержащее наименование предприятия. 
  </li>
  <li>Для объединения города и адреса клиента нажмите кнопку вызова построителя выражения поля Functions and expressions (Функции и выражения) и в диалоговом окне Expression Builder (Построитель выражений) создайте следующее выражение: 
<P>
ALL/TRIM (Ccity) +  &quot;,   &quot;  +ALLTRIM(Caddress) 
</P>
<P>
&nbsp;</P>
  </li>
  <li>Закройте окно построителя выражения, нажав кнопку ОК. </li>
  <li>Для размещения созданного выражения в списке Selected fields (Выбранные поля) нажмите кнопку Add (Добавить). 
  </li>
  <li>На этом формирование запроса завершено (рис. 9.4). Нажмите кнопку Run 
  (Выполнить) на стандартной панели инструментов, и на экране появится результирующая таблица (рис. 9.5). 
  </li>
</ol>
<IMG src="gl9-4.jpg" alt="gl9-4.jpg" ></IMG>
<P>
Рис. 9.4. Определение вычисляемого поля 
</P>
<IMG src="gl9-5.jpg" alt="gl9-5.jpg" ></IMG>
<P>
Рис. 9.5. Результат выборки 
</P>
<p>&nbsp;
<a NAME="7"></a><font size="4">Вкладка Order By конструктора запросов </font> 
</P>
<P>
Вкладка Order By (Упорядочение) конструктора запросов (рис. 9.6) позволяет указать критерий упорядочения данных в результирующей таблице, используя одно или несколько полей исходной таблицы, перенесенных из списка Selected fields (Выбранные поля) в список Ordering criteria (Критерии упорядочения). Для каждого поля в списке Ordering criteria (Критерии упорядочения) 
вы можете указать критерий упорядочения, используя следующие опции переключателя Order options (Опции упорядочения): 
</P>
<ul>
  <li>Ascending — по возрастанию; </li>
  <li>Descending — по убыванию. </li>
</ul>
<P>
В списке Ordering criteria (Критерии упорядочения) с левой стороны поля, для которого установлена опция Ascending (По возрастанию), расположена направленная вверх стрелка. Для обозначения упорядочения по убыванию используется стрелка, направленная вниз. 
</P>
<IMG src="gl9-6.jpg" alt="gl9-6.jpg" ></IMG>
<P>
Рис. 9.6. Вкладка Order By конструктора позволяет сформировать условия упорядочения данных в запросе 
</P>
<P>
Порядок сортировки записей результирующей таблицы определяется порядком следования полей в списке Ordering criteria (Критерии упорядочения) и
критерием упорядочения отдельных полей. Для изменения порядка следования полей в списке Ordering criteria (Критерии упорядочения) предназначен маркер перемещения, расположенный слева от поля. 
</P>
<P>
Рассмотрим создание запроса для таблицы customer, в котором упорядочим отображаемые в результирующей таблице данные по городам клиентов. 
</P>
<ol>
  <li>Откройте окно конструктора запросов. </li>
  <li>В открывшемся диалоговом окне Add Table or View (Добавить таблицу или представление) выберите таблицу customer. 
  </li>
  <li>На вкладке Fields (Поля) перенесите в список Selected fields (Выбранные
  <span lang="ru">поля</span>) <span lang="ru">поля</span> Ccompany 
  <span lang="ru">и</span> Ccity. </li>
  <li>Откройте вкладку Order By (Упорядочение). </li>
  <li>Дважды щелкнув на поле Ccity, перенесите его в список Ordering criteria 
  (Критерии упорядочения). По умолчанию для него установлена опция Ascending, т. 
  е. данные будут упорядочены в алфавитном порядке по возрастанию. </li>
  <li>Нажмите кнопку Run (Выполнить) на стандартной панели инструментов и просмотрите результаты выполненного запроса (рис. 9.7). 
  </li>
</ol>
<IMG src="gl9-7.jpg" alt="gl9-7.jpg" ></IMG>
<P>
Рис. 9.7. Результаты выборки запроса 
</P>
<p>&nbsp;
<a NAME="8"></a><font size="4">Упорядочение по нескольким полям </font> 
</P>
<P>
Теперь рассмотрим ситуацию, когда необходимо упорядочить данные по нескольким полям. В этом примере отобразим данные в результирующей таблице 
<span lang="ru">по</span> городам клиентов в алфавитном порядке и по убыванию значений 
кредита. При формировании запроса воспользуемся запросом, созданным в предыдущем примере. 
</P>
<ol>
  <li>На вкладке Fields (Поля) добавьте в список Selected fields (Выбранные
  <span lang="ru">поля</span>) Поле YcreditLimit. </li>
  <li>В окне конструктора запросов перейдите на вкладку Order By (Упорядочение). 
  В списке Ordering criteria (Критерии упорядочения) находится поле ccity, по значению которого были упорядочены данные в предыдущем запросе. 
  </li>
  <li>Выделите поле YcreditLimit и дважды щелкните по нему мышью. Поле будет перенесено в список Ordering criteria (Критерии упорядочения). 
  </li>
  <li>Установите для данного поля опцию Descending (По убыванию). Обратите внимание, как выглядит теперь окно конструктора запросов (рис. 9.8). 
  </li>
</ol>
<IMG src="gl9-8.jpg" alt="gl9-8.jpg" ></IMG>
<P>
Рис. 9.8. Использование для упорядочения двух полей 
</P>
<P>
В списке Ordering criteria (Критерии упорядочения) рядом с полем ccity расположена стрелка, направленная вверх, а рядом с полем YcreditLimit — стрелка, направленная вниз. Направленная вверх стрелка означает, что данные отображаются в порядке возрастания, а направленная вниз — что данные расположены в порядке убывания. 
</P>
<p>&nbsp;
<a NAME="9"></a><font size="4">Задание условий для выбора записей </font> 
</P>
<P>
Во всех рассмотренных ранее примерах в запрос включались все или часть полей 
исходной таблицы, упорядоченных соответствующим образом. В большинстве случаев требуется получить отдельные записи исходной таблицы, удовлетворяющие определенным условиям. 
</P>
<P>
Для формирования условий выбора определенных записей предназначена вкладка Filter (Фильтр) конструктора запросов. 
</P>
<p>&nbsp;
<a NAME="10"></a><font size="4">Задание условия точного совпадения значений одного поля </font> 
</P>
<P>
На практике часто требуется выбрать из таблицы запись или группу записей, одно из полей которых содержит заданную величину. Например, вам требуется список всех клиентов, живущих в Москве. В этом случае вам необходимо на вкладке Filter (Фильтр) ввести требуемые значения в соответствующих полях, создав тем самым шаблон, с которым, прежде чем помещать записи в результирующую таблицу, Visual FoxPro будет сравнивать все записи исходной таблицы. 
</P>
<P>
В этом примере выберем данные о клиентах из Москвы. 
</P>
<ol>
  <li>Откройте окно конструктора запросов. </li>
  <li>Поместите в него таблицу customer. </li>
  <li>На вкладке Fields (Поля) перенесите в список Selected fields (Выбранные поля) наименование предприятия. 
  </li>
  <li>Перейдите на вкладку Filter (Фильтр) конструктора запросов. </li>
  <li>В столбце Field Name (Имя поля) нажмите кнопку раскрытия списка и из всех полей исходной таблицы выберите ccity. 
  </li>
  <li>В списке Criteria (Критерии) выберите значение ==. </li>
  <li>В поле Example (Образец) введите Москва (рис. 9.9). </li>
  <li>Для выполнения запроса нажмите кнопку Run (Выполнить). На экране появится результирующая таблица, которая содержит записи о клиентах, чьи фирмы расположены в Москве. 
  </li>
</ol>
<IMG src="gl9-9.jpg" alt="gl9-9.jpg" ></IMG>
<P>
Рис. 9.9. Задание условия точного совпадения значения одного поля 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Если условие выбора, вводимое в поле Example, содержит специальные символы или ключевые слова языка запросов, поместите задаваемое условие в кавычки.
</font> 
</P>
<p>&nbsp;
<a NAME="11"></a><font size="4">Выбор полей, не удовлетворяющих заданному условию </font> 
</P>
<P>
Флажок Not (He), расположенный на вкладке Filter (Фильтр) окна конструктора 
запросов, позволяет выбрать из таблицы записи, не удовлетворяющие заданному условию. Например, в предыдущем примере мы осуществляли выбор клиентов, проживающих в Москве. Если бы в дополнение к заданному условию выборки мы установили флажок Not (He), то в результирующей таблице мы получили бы список клиентов, не проживающих в Москве. 
</P>
<P>
В данном примере выберем из таблицы customer все записи, за исключением записей со значением Казахстан в поле ccountry. 
</P>
<ol>
  <li>Откройте запрос, созданный в предыдущем примере. </li>
  <li>Перейдите на вкладку Filter (Фильтр). </li>
  <li>В столбце Field Name (Имя поля) выберите из раскрывающегося списка
  <span lang="ru">поле</span> Ccountry. </li>
  <li>Щелкните мышью в поле Not (He), установив тем самым флажок. </li>
  <li>В списке вариантов сравнения Criteria (Критерий) выберите значение ==, 
  </li>
  <li>В текстовом поле столбца Example (Образец) введите Казахстан (рис. 9.10). 
  </li>
  <li>Для выполнения запроса нажмите кнопку Run (Выполнить). На экране появится результирующая таблица, которая содержит записи о клиентах, проживающих вне Казахстана. 
  </li>
</ol>
<IMG src="gl9-10.jpg" alt="gl9-10.jpg" ></IMG>
<P>
Рис. 9.10. Задание условия для выбора полей, не удовлетворяющих определенному критерию 
</P>
<p>&nbsp;
<a NAME="12"></a><font size="4">Выбор похожих значений </font> 
</P>
<P>
Список вариантов сравнения Criteria (Критерий) вкладки Filter (Фильтр) содержит 
значения, позволяющие задавать различные критерии выбираемых в результирующую 
таблицу записей. При работе с большими таблицами время от времени возникает 
необходимость найти записи, точное написание которых вы не знаете. Например, вы 
не знаете, верхний или нижний регистр был использован при вводе записей. В этом случае вы можете осуществить выбор записей по условию неточного совпадения значений. </P>
<P>
Предположим, что в таблице customer требуется найти запись о фирме, представитель которой имеет фамилию, начинающуюся на &quot;Ник&quot;. Для поиска необходимых записей выполните следующие действия: 
</P>
<ol>
  <li>Откройте окно конструктора запросов. </li>
  <li>Поместите в него таблицу Customer. </li>
  <li>На вкладке Fields (Поля) выделите курсором поля, которые хотите отобразить в запросе, и с помощью кнопки Add (Добавить) перенесите их в список Selected fields (Выбранные поля). 
  </li>
  <li>Для задания условия на вкладке Filter (Фильтр) выберите поле с last name. 
  </li>
  <li>В списке вариантов сравнения выберите значение =. </li>
  <li>В поле столбца Example (Образец) введите Ник (рис. 9.11). В результате выполнения запроса Visual FoxPro отобразит в результирующей таблице записи о фирмах, имеющих представителей с фамилиями Никифоров и Николаев. 
  </li>
</ol>
<IMG src="gl9-11.jpg" alt="gl9-11.jpg" ></IMG>
<P>
Рис. 9.11. Задание условия неточного совпадения 
</P>
<p>&nbsp;
<a NAME="13"></a><font size="4">Выбор записей, находящихся в заданном диапазоне значений </font> 
</P>
<P>
Для выбора записей, лежащих в заданном диапазоне значений, используются операторы &gt; (Больше), &lt; (Меньше) и Between (Между) из списка Criteria (Критерий) вкладки Filter (Фильтр). Операторы &gt; (Больше) и &lt; (Меньше) используются в том случае, если задана только нижняя или верхняя граница диапазона, a Between (Между) — когда известны обе границы. Предположим, что вам потребовался список заказов, итоговая сумма которых превышает 10 000 рублей. В другом случае вам нужно получить сведения о клиентах, воспользовавшихся услугами вашей фирмы в определенный интервал времени. В обоих случаях необходимо выбрать из таблицы записи, попадающие в диапазон значений. 
</P>
<P>
Создадим запрос, формирующий список заказов, итоговая сумма которых превышает 10 000 рублей. 
</P>
<ol>
  <li>Откройте новое окно конструктора запросов. </li>
  <li>Добавьте в него таблицу ordsaiem. </li>
  <li>В списке Selected fields (Выбранные поля) вкладки Fields (Поля) разместите поля с номером заказа, датой и итоговой суммой по заказу. 
  </li>
  <li>Для задания условия отбора на вкладке Filter (Фильтр) выберите поле
nsumdoc. </li>
  <li>В списке Criteria (Критерий) выберите оператор &gt;. </li>
  <li>В текстовом поле столбца Example (Пример) введите 10 000. </li>
  <li>Нажмите кнопку Run (Выполнить) на стандартной панели инструментов. </li>
</ol>
<P>
На экране появляется результирующая таблица, содержащая заказы, итоговая сумма по которым превышает 10 000. 
</P>
<P>
В этом примере мы задавали только нижнюю границу диапазона. Очевидно, что для получения списка продаж за определенный интервал времени необходимо задать начальную и конечную даты. Воспользуемся запросом, созданным в предыдущем примере, и изменим в нем заданные на вкладке Filter (Фильтр) условия выбора записей. 
</P>
<ol>
  <li>Откройте запрос, созданный в предыдущем примере. </li>
  <li>На вкладке Filter (Фильтр) из списка Field Name (Имя поля) выберите поле ddoc, содержащее дату заказа. 
  </li>
  <li>В списке Criteria (Критерий) выберите значение Between (Между). </li>
  <li>В поле Example (Образец) введите начальную и конечную даты интервала (рис. 9.12) в следующем виде: 
<P>
CTOD(&quot;01.11.2001&quot;) , CTOD(&quot;15.11.2001&quot;) 
</P>
  </li>
</ol>
<IMG src="gl9-12.jpg" alt="gl9-12.jpg" ></IMG>
<P>
Рис. 9.12. Выбор записей по диапазону значений поля дат 
</P>
<ol>
  <li value="5">Нажмите кнопку Run (Выполнить) на стандартной панели инструментов. 
  </li>
</ol>
<P>
Просмотрите данные в появившейся на экране результирующей таблице. Она содержит информацию о всех продажах за указанный в запросе интервал времени. 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">При задании условий для выбора записей по диапазону значений можно использовать не только числовые поля, но и текстовые. В этом случае при выполнении запроса Visual FoxPro сравнивает коды символьных величин. Например, условие выбора &quot;Л, М&quot;, помещенное в поле Example (Образец) для поля Ccompany, позволит выбрать из таблицы Customer список предприятий, названия которых начинаются на буквы Л и М.
</font> 
</P>
<p>&nbsp;
<a NAME="14"></a><font size="4">Формирование списка условий </font> 
</P>
<P>
Visual FoxPro позволяет при создании запросов формировать несколько условий. В том случае, если все задаваемые условия накладываются на одно поле, их можно разместить в одной строке. В противном случае условия размещаются в разных строках вкладки Filter (Фильтр). Рассмотрим следующий пример. Выберем всех покупателей из Москвы, Новгорода и Киева. 
</P>
<ol>
  <li>Откройте окно конструктора запросов. </li>
  <li>Поместите в него таблицу customer. </li>
  <li>На вкладке Fields (Поля) разместите в списке Selected fields (Выбранные поля) требуемые поля. 
  </li>
  <li>Откройте вкладку Filter (Фильтр). </li>
  <li>Из  списка  Field  Name   (Имя   поля),  содержащего  все  поля  таблицы Customer, выберите поле Ccity. 
  </li>
  <li>В списке Criteria (Критерии) выберите значение In (В). </li>
  <li>В поле столбца Example (Пример) через запятую задайте названия городов, покупатели которых вас интересуют (рис. 9.13). 
  </li>
  <li>Для просмотра результатов выборки нажмите кнопку Run (Выполнить) на стандартной панели инструментов. 
  </li>
</ol>
<IMG src="gl9-13.jpg" alt="gl9-13.jpg" ></IMG>
<P>
Рис. 9.13. Окно запроса со списком условий отбора 
</P>
<p>&nbsp;
<a NAME="15"></a><font size="4">Многотабличные запросы </font> 
</P>
<P>
Во всех рассмотренных ранее в этой главе примерах данные при формировании запроса выбирались из одной таблицы. На практике при формировании 
запросов часто используются выборки из нескольких таблиц, т. к. в реляционных базах данных информация содержится не в одной отдельной таблице, а в совокупности связанных таблиц. </P>
<P>
При создании многотабличного запроса в окно конструктора запросов добавляются все участвующие в выборке таблицы и определяются условия их объединения. Если между участвующими в запросе таблицами в базе данных установлены постоянные отношения, то в окне конструктора запросов эта связь будет отображаться в виде линии, соединяющей таблицы, а на вкладке Join (Объединение) появится запись, содержащая условие объединения таблиц (рис. 9.14). 
</P>
<IMG src="gl9-14.jpg" alt="gl9-14.jpg" ></IMG>
<P>
Рис. 9.14. Вкладка Join содержит условия объединения таблиц 
</P>
<P>
Если таблица, добавляемая в конструктор запросов, не имеет установленных в базе данных связей с уже размещенными в конструкторе таблицами, на экране открывается диалоговое окно Join Condition (Условие объединения) (рис. 9.15), в котором необходимо задать условие объединения двух таблиц. 
</P>
<P>
В верхней части диалогового окна Join Condition (Условие объединения) размещены два раскрывающихся списка, содержащие поля, которые можно использовать для объединения таблиц. Ниже расположен переключатель Type of join (Тип объединения), содержащий опции, определяющие тип создаваемой между таблицами связи. Назначение опций описано в табл. 9.3. 
</P>
<IMG src="gl9-15.jpg" alt="gl9-15.jpg" ></IMG>
<P>
Рис. 9.15. Определение условия объединения таблиц в диалоговом окне Join Condition 
</P>
<P>
Таблица 9.3. Назначение опций диалогового окна Join Condition 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Опция 
</TD>
<TD VALIGN="TOP">
Тип создаваемой связи 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Inner join 
</P>
<P>
(Внутреннее объединение) 
</TD>
<TD VALIGN="TOP">
Создает объединение, в котором выбираются только те записи, которые содержат совпадающие значения в полях связи 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Left join 
</P>
<P>
(Объединение слева) 
</TD>
<TD VALIGN="TOP">
Создает объединение, в котором выбираются все записи из левой таблицы, а также записи из правой таблицы, значения поля связи которого совпадают со значениями поля связи левой таблицы 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Right join 
</P>
<P>
(Объединение справа) 
</TD>
<TD VALIGN="TOP">
Создает объединение, в котором выбираются все записи из правой таблицы, а также записи из левой таблицы, значения поля связи которого совпадают со значениями поля связи правой таблицы 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Full join (Полное объединение) 
</TD>
<TD VALIGN="TOP">
Создает объединение,  в котором выбираются все записи из правой и левой таблиц 
</TD>
</TR>
</TABLE>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">По умолчанию Visual FoxPro при объединении таблиц использует опцию Inner join (Внутреннее объединение), при которой из таблиц выбираются только те записи, которые содержат совпадающие значения в полях связи.
</font> 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">В отличие от постоянных отношений, определяемых между таблицами в базе данных, при объединении таблиц в конструкторе запросов вы можете использовать любые поля таблиц.
</font> 
</P>
<P>
Установленные между таблицами условия объединения  можно  изменять. Для этого выполните следующие действия: 
</P>
<ol>
  <li>Дважды щелкните мышью на линии, связывающей таблицы, или на вкладке Join (Объединение) нажмите кнопку с двунаправленной стрелкой с левой стороны поля Туре (Тип). 
  </li>
  <li>В открывшемся диалоговом окне Join Condition (Условие объединения), отображающем текущее условие объединения таблиц, измените требуемые параметры. 
  </li>
  <li>Нажмите кнопку ОК. </li>
</ol>
<P>
<font color="#800000"><b>Совет</b></font></P>
<P>
<font color="#800000">Для установления связи между таблицами в конструкторе запросов, как и в базе данных, можно использовать механизм &quot;перенести-и-оставить&quot;. Выберите поле одной из таблиц, нажмите кнопку мыши и удерживая ее нажатой, перенесите поле на связываемое поле в другой таблице. После этого откройте диалоговое окно Join Condition (Условие объединения) и отредактируйте установленное условие объединения таблиц.
</font> 
</P>
<p>&nbsp;
<a NAME="16"></a><font size="4">Выборка из четырех таблиц </font> 
</P>
<P>
Рассмотрим пример выборки товаров, приобретенных клиентами. Для решения ЭТОЙ задачи нам потребуются таблицы Customer, Ordsalem, Ordsaled
и Goods. Таблица customer содержит информацию о клиентах, таблица Ordsalem — сведения о заказе на товары, таблица Ordsaled — сведения о товарах, входящих в заказ (количество купленных товаров и цена товара), а таблица Goods — наименования всех товаров. При создании базы данных между этими таблицами уже были определены постоянные отношения. 
</P>
<ol>
  <li>Откройте новое окно конструктора запросов. </li>
  <li>Добавьте в конструктор запросов таблицы Customer, Ordsalem, Ordsaled
и Goods. Между этими таблицами в базе данных установлены постоянные отношения. 
После их перенесения в запрос в окне конструктора запросов отобразятся установленные между таблицами связи, а на вкладку Join (Объединение) добавятся три строки с условиями объединения таблиц (рис. 9.16). 
  </li>
  <li>В список Selected fields (Выбранные поля) вкладки Fields (Поля) перенесите фамилию клиента, номер заказа, наименование товара и количество заказанного им товара. 
  </li>
  <li>Нажмите кнопку Run (Выполнить), и на экране появится результирующая таблица (рис. 9.17), содержащая информацию о заказах всех клиентов. 
  </li>
</ol>
<IMG src="gl9-16.jpg" alt="gl9-16.jpg" ></IMG>
<P>
Рис. 9.16. Вкладка Join окна запроса для выборки из четырех таблиц 
</P>
<IMG src="gl9-17.jpg" alt="gl9-17.jpg" ></IMG>
<P>
Рис. 9.17. Результаты запроса для выборки из четырех таблиц 
</P>
<p>&nbsp;
<a NAME="17"></a><font size="4">Группировка полей запроса </font> 
</P>
<P>
Группировка полей запроса позволяет получить информацию о подгруппах таблицы. Например, сгруппировав по коду заказа данные в таблице, содержащей сведения о заказах, можно получить сведения об итоговой сумме по каждому заказу. 
</P>
<P>
Для группировки записей в запросе предназначена вкладка Group By (Группировка) (рис. 9.18), содержащая список Grouped fields (Поля группировки) с полями, по которым осуществляется группировка данных. 
</P>
<IMG src="gl9-18.jpg" alt="gl9-18.jpg" ></IMG>
<P>
Рис. 9.18. Вкладка Group By окна конструктора запросов 
</P>
<p>&nbsp;
<a NAME="18"></a><font size="4">Использование в запросе выражений и функций полей </font> 
</P>
<P>
В запрос можно включать статистические значения, вычисляемые по одному или нескольким полям исходной таблицы. Например, используя функцию COUNT (), вы можете подсчитать количество клиентов, проживающих в том или ином городе. 
</P>
<P>
Кроме того, Visual FoxPro позволяет выполнять итоговые операции над вычисляемыми в запросе полями. Например, в запросе, выбирающем данные
из таблиц ordsaiem и Ordsaied, вы можете вычислить итоговую стоимость продажи каждого товара за интересующий вас интервал времени. 
</P>
<P>
Для  вычисления  итоговых значений  в  запросе  вы  можете  использовать функции, описанные в табл. 9.4. 
</P>
<P>
Таблица 9.4. Функции для вычисления итоговых значений в запросе 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Функция 
</TD>
<TD VALIGN="TOP">
Результат вычисления 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
COUNT ( ) 
</TD>
<TD VALIGN="TOP">
Количество строк в итоговой таблице 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
МАХ() 
</TD>
<TD VALIGN="TOP">
Наибольшее значение в столбце 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
MIN() 
</TD>
<TD VALIGN="TOP">
Наименьшее значение в столбце 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
AVG() 
</TD>
<TD VALIGN="TOP">
Среднее значение столбца численных данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
SUM() 
</TD>
<TD VALIGN="TOP">
Сумма численных данных столбца 
</TD>
</TR>
</TABLE>
<P>
Для формирования в запросе выражения предназначено поле Functions and expressions (Функции и выражения) вкладки Fields (Поля) и расположенная справа от него кнопка открытия построителя выражения. Нажмите данную кнопку. Откроется диалоговое окно Expression Builder (Построитель выражения) (рис. 9.19). В поле ввода Expression (Выражение) сформируйте итоговое значение, используя поля таблиц запроса, расположенные в списке Fields (Поля), и функции области Functions (Функции), сгруппированные по типам данных и представленные в виде четырех списков. 
</P>
<IMG src="gl9-19.jpg" alt="gl9-19.jpg" ></IMG>
<P>
Рис. 9.19. Диалоговое окно Expression Builder позволяет включить в запрос функцию или выражение 
</P>
<P>
При нажатии кнопки Options (Опции) открывается диалоговое окно Expression Builder Options (Опции построителя выражения) (рис. 9.20). Используя параметры этого окна, можно настроить список наиболее часто используемых в запросе функций, отображаемых в области Functions (Функции) диалогового окна Expression Builder (Построитель выражения). 
</P>
<IMG src="gl9-20.jpg" alt="gl9-20.jpg" ></IMG>
<P>
Рис. 9.20. Диалоговое окно Expression Builder Options 
</P>
<P>
Чтобы настроить список функций, выполните следующие действия: 
</P>
<ol>
  <li>В диалоговом окне Expression Builder Options (Опции построителя выражений) установите опцию типа настраиваемой функции. 
  </li>
  <li>Нажмите кнопку Clear (Очистить) для очистки списка функций. </li>
  <li>Используя клавишу &lt;Shift&gt;,  если  выбираемые функции  расположены подряд в списке, или клавишу &lt;Ctrl&gt;, выберите необходимые функции. 
  </li>
  <li>Нажмите кнопку ОК. </li>
</ol>
<P>
В нижней части диалогового окна Expression Builder Options (Опции построителя выражений) находится группа переключателей Field aliases (Псевдонимы поля), содержащая опции, описанные в табл. 9.5. 
</P>
<P>
Таблица 9.5. Назначение группы переключателей Field aliases диалогового окна Expression Builder Options 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Переключатель 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Always add alias (Всегда добавлять псевдоним) 
</TD>
<TD VALIGN="TOP">
Указывает, что имя таблицы или представления данных всегда включается в имя поля 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Add non-selected alias only (Добавлять только невыбранные псевдонимы) 
</TD>
<TD VALIGN="TOP">
Если открыто более одной таблицы или представления данных, Visual FoxPro 
включает имя таблицы или представления данных только в том случае, если они не содержатся в списке псевдонимов в окне Data Session (Сеанс данных) 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Never add alias (He добавлять псевдоним) 
</TD>
<TD VALIGN="TOP">
Указывает, что имя таблицы или представления данных никогда не включается в имя поля 
</TD>
</TR>
</TABLE>
<P>
Флажок Show system memory variables (Показывать системные переменные) указывает, будут ли отображаться в окне построителя выражения системные переменные. 
</P>
<P>
При формировании выражения вы можете использовать поля, константы и функции, связанные арифметическими операторами, список которых приведен в табл. 9.6. 
</P>
<P>
Таблица 9.6. Арифметические операторы, используемые
при формировании выражений 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Оператор 
</TD>
<TD VALIGN="TOP">
Функция 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
+ 
</TD>
<TD VALIGN="TOP">
Сложение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
_ 
</TD>
<TD VALIGN="TOP">
Вычитание 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
* 
</TD>
<TD VALIGN="TOP">
Умножение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
/ 
</TD>
<TD VALIGN="TOP">
Деление 
</TD>
</TR>
</TABLE>
<P>
Для изменения порядка вычислений в формируемом выражении, а также для группировки данных можно использовать круглые скобки. 
</P>
<p>&nbsp;
<a NAME="19"></a><font size="4">Включение в запрос итоговых значений</font>
</P>
<P>
В   данном   примере создадим запрос   для   таблиц   Ordsalem   и   Ordsaled   
об
итоговой сумме по каждому заказу. 
</P>
<ol>
  <li>Откройте окно запроса для таблиц Ordsalem и Ordsaled. </li>
  <li>На вкладке Fields (Поля) перенесите в список Selected fields (Выбранные поля) поле cndoc, содержащее номер документа. 
  </li>
  <li>Чтобы вычислить стоимость проданного товара по текущему заказу, воспользуйтесь функцией зим. Для этого нажмите кнопку открытия диалогового окна Expression Builder (Построитель выражения) поля Functions and expressions (Функции и выражения). 
  </li>
  <li>В поле ввода Expression (Выражение) открывшегося диалогового окна введите выражение, по которому будет просуммирована стоимость каждого проданного товара и помещена в соответствующее поле результирующей таблицы: 
<P>
SUM (Ordsaled. nQuant  *  Ordsaled.nUnitPri.ee) 
</P>
<P>
&nbsp;</P>
  </li>
  <li>Нажмите кнопку OK для закрытия диалогового окна Expression Builder
(Построитель выражения). </li>
  <li>Для перемещения сформированного выражения в список Selected fields (Выбранные поля) нажмите кнопку Add (Добавить). 
  </li>
  <li>Для группировки записей результирующей таблицы по полю icdorder откройте вкладку Group By (Группировка) и перенесите поле icdorder в список Grouped fields (Поля группировки). 
  </li>
  <li>Сохраните запрос. Для выполнения запроса нажмите кнопку Run (Выполнить). На экране появится результирующая таблица, содержащая информацию об итоговой стоимости товаров по каждому заказу (рис. 9.21). 
  </li>
</ol>
<IMG src="gl9-21.jpg" alt="gl9-21.jpg" ></IMG>
<P>
Рис. 9.21. Результат выборки 
</P>
<p>&nbsp;
<a NAME="20"></a><font size="4">Изменение наименований полей в запросе</font> 
</P>
<P>
Visual FoxPro по умолчанию присваивает полям результирующей таблицы запроса наименования, которые имеют поля исходной таблицы. Вычисляемым 
и итоговым полям присваиваются наименования в соответствии с соглашением, принятым в Visual FoxPro. 
</P>
<P>
Используя ключевое слово AS, вы можете по своему усмотрению изменить наименования полей результирующей таблицы. При этом наименования полей изменятся только в результирующей таблице, а имена полей в исходной таблице останутся без изменения. 
</P>
<P>
Для изменения наименования поля необходимо за именем поля или выражением, заданным для определения поля результирующей таблицы, поместить ключевое слово AS, а за ним указать новое имя поля. 
</P>
<P>
В предыдущем примере наименование итогового поля было определено Visual FoxPro 
по умолчанию. Результат запроса будет более читабельным, если вы измените наименования полей. Для этого выполните следующие действия: 
</P>
<ol>
  <li>Откройте окно запроса, созданного в предыдущем примере. </li>
  <li>Добавьте в поле, содержащее номер заказа, ключевое слово AS и наименование 
  поля заказ.
 OrdSalem.cnDoc AS заказ </li>
  <li>3. Аналогичным образом добавьте в итоговое поле вычисления итоговой стоимости заказа ключевое слово AS и наименование поля стоимость. 
<P>
 SUM(OrdSaled.nQuant * OrdSaled.nUnitPrice) AS Стоимость 
</P>
<P>
 &nbsp;</P>
  </li>
  <li>Сохраните запрос. Для выполнения запроса нажмите кнопку Run (Выполнить), в результате на экране появится результирующая таблица, содержащая новые наименования полей (рис. 9.22). 
  </li>
</ol>
<IMG src="gl9-22.jpg" alt="gl9-22.jpg" ></IMG>
<P>
Рис. 9.22. Изменение наименования полей 
</P>
</BODY>
</HTML>