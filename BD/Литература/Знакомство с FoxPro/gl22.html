<HTML>
<HEAD>
<TITLE></TITLE>
<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="TEXT/HTML; CHARSET=WINDOWS-1251">
</HEAD>
<body background="../fon.jpg">

<p><CENTER><font size="4"><b>ГЛАВА 22
<br>
Удаленные представления данных </b></font>
</center>
</P>
<br>
<br>

<ul>
  <li><a href="gl22.html#1">Определение источника данных ODBC </a>
  <li><a href="gl22.html#2">Именованное соединение </a>
  <li><a href="gl22.html#3">Конструктор соединений </a>
  <li><a href="gl22.html#4">Настройка параметров удаленных представлений и соединений в диалоговом окне Qptions</a>
  <li><a href="gl22.html#5">Создание удаленного представления данных </a>
  <li><a href="gl22.html#6">Использование мастера удаленных представлений</a>
  <li><a href="gl22.html#7">Использование конструктора представлений </a>
  <li><a href="gl22.html#8">Использование команды CREATE SQL VIEW </a>
  <li><a href="gl22.html#9">Особенности использования удаленных представлений данных для электронных таблиц Microsoft Excel</a>
  <li><a href="gl22.html#10">Совместно используемые соединения</a>
  <li><a href="gl22.html#11">Комбинирование в представлении локальных и удаленных данных</a>
  <li><a href="gl22.html#12">Настройка представления с помощью словаря базы данных </a>
</ul>

<P>
Информация, используемая в разрабатываемом приложении, может находиться не только в таблицах Visual FoxPro, но и в электронных таблицах Microsoft Excel, в текстовом виде, в файлах базы данных Paradox или же на сервере базы данных типа SQL Server. 
Все такие данные называются удаленными данными, несмотря на то, что они могут находиться даже на одном компьютере с Visual FoxPro. 
</P>
<P>
Для доступа к удаленным данным используется стандартный протокол доступа к базам данных (ODBC). Все базы данных, а также электронные таблицы имеют драйверы ODBC, с помощью которых вы можете соединяться с ними и получать доступ к их содержимому. 
</P>
<p>&nbsp;
<a NAME="1"></a><font size="4">Определение источника данных ODBC </font> 
</P>
<P>
После установки драйверов ODBC вы можете определить для него один или
несколько источников данных ODBC. 
</P>
<P>
Для добавления источника данных ODBC выполните следующие действия: 
</P>
<ol>
  <li>Выберите на Панели управления Windows пиктограмму Источники данных (ODBC). 
  </li>
  <li>Далее в диалоговом окне ODBC Data Source Administrator
(Администрирование источника данных ODBC) (рис. 22.1) нажмите кнопку Add (Добавить). 
  </li>
  <li>На экране появится диалоговое окно Create New Data Source (Создать новый 
  источник данных) (рис. 22.2). Выберите нужный драйвер из представленного в диалоговом окне списка и нажмите кнопку Готово. 
  </li>
  <li>В следующем диалоговом окне ODBC Setup (Установка ODBC) (рис. 22.3) установите необходимые значения параметров соединения и нажмите кнопку ОК. 
  </li>
</ol>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Вид диалогового окна настройки параметров соединения зависит от типа источника данных. Тем не менее, для всех источников данных необходимо в поле
ввода Name (Имя) указать имя источника данных, которое в дальнейшем используется для ссылки на источник данных. Поле ввода Description 
(Описание) содержит краткое описание источника данных. Если при определении 
значений остальных полей возникнут проблемы, обратитесь к администратору базы 
данных, к которой вы собираетесь определить доступ. </font> 
</P>
<IMG src="gl22-1.jpg" alt="gl22-1.jpg" width="461" height="377" ></IMG>
<P>
Рис. 22.1. Диалоговое окно ODBC Data Source Administrator 
</P>
<IMG src="gl22-2.jpg" alt="gl22-2.jpg" width="468" height="345" ></IMG>
<P>
Рис. 22.2. Диалоговое окно Create New Data Source 
</P>
<IMG src="gl22-3.jpg" alt="gl22-3.jpg" width="500" height="348" ></IMG>
<P>
Рис. 22.3. Диалоговое окно определения параметров соединения 
</P>
<p>&nbsp;
<a NAME="2"></a><font size="4">Именованное соединение </font> 
</P>
<P>
Удобным средством для работы с удаленными данными является именованное соединение, которое хранится в базе данных и на которое можно ссылаться по имени при создании удаленного представления. 
</P>
<IMG src="gl22-4.jpg" alt="gl22-4.jpg" width="500" height="423" ></IMG>
<P>
Рис. 22.4. Раздел Connections списка Database 
</P>
<P>
Вы также можете устанавливать свойства именованного соединения для оптимизации связи между Visual FoxPro и удаленным источником данных. При активизации удаленного представления его соединение становится каналом, ведущим к удаленному источнику данных. 
</P>
<P>
Для создания именованного соединения выполните любое из следующих действий: 
</P>
<ul>
  <li>в диспетчере проектов из списка Databases (Базы данных) выберите раздел  Connections  (Соединения)  (рис. 22.4), затем нажмите  кнопку New (Новый), чтобы вызвать конструктор соединений; 
  </li>
  <li>откройте базу данных и используйте команду CREATE CONNECTION, чтобы
открыть конструктор соединений; </li>
  <li>используйте команду CREATE CONNECTION (Создать соединение) с именем соединения в качестве параметра. 
  </li>
</ul>
<p>&nbsp;
<a NAME="3"></a><font size="4">Конструктор соединений </font> 
</P>
<P>
Окно конструктора соединений (рис. 22.5) позволяет вам задать параметры
именованного соединения в интерактивном режиме. 
</P>
<IMG src="gl22-5.jpg" alt="gl22-5.jpg" width="500" height="423" ></IMG>
<P>
Рис. 22.5. Окно конструктора соединений 
</P>
<P>
Область Specify data source (Определить источник данных) содержит переключатели Data source, userid, password (Источник данных, идентификатор пользователя, пароль) и Connection string 
(Строка соединения), определяющие способ соединения с источником данных. При выборе первой опции в области отображаются поля ввода (табл. 22.1). 
</P>
<P>
Таблица 22.1. Назначение полей ввода области Specify data source 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Поле 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Data source 
</P>
<P>
(Источник данных) 
</TD>
<TD VALIGN="TOP">
Имя источника данных из списка установленных источников данных ODBC 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Userid 
</P>
<P>
(Идентификатор пользователя) 
</TD>
<TD VALIGN="TOP">
Идентификатор пользователя для выбранного источника данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Password (Пароль) 
</TD>
<TD VALIGN="TOP">
Пароль пользователя 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Database 
</P>
<P>
(База данных) 
</TD>
<TD VALIGN="TOP">
Имя базы данных 
</TD>
</TR>
</TABLE>
<P>
При выборе переключателя Connection string (Строка соединения) вместо приведенных выше полей ввода отображается только одно поле ввода Connect string (Строка соединения), в котором можно ввести строку соединения с источником данных. 
</P>
<P>
Кнопка Verify Connection (Проверить соединение) предназначена для проверки соединения с указанным источником данных. Кнопка New Data Source (Новый источник данных) позволяет определить новый источник данных непосредственно из конструктора соединений. 
</P>
<P>
Область Display ODBC login prompts (Отображение окна доступа к ODBC источнику) содержит переключатели, определяющие, когда будет открываться диалоговое окно Data Source Login (Доступ к источнику данных) (табл. 22.2). 
</P>
<P>
Таблица 22.2. Переключатели области Display ODBC login prompts 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Наименование 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
When login info is not specified (Когда параметры доступа не определены) 
</TD>
<TD VALIGN="TOP">
Диалоговое окно Data Source Login (Доступ к источнику данных) открывается только в том случае, если заданный идентификатор пользователя и пароль не найдены в определении именованного соединения 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Always (Всегда) 
</TD>
<TD VALIGN="TOP">
Указывает, что Visual FoxPro всегда открывает для пользователя диалоговое окно Data Source Login (Доступ к источнику данных), в котором можно выбрать другой регистрационный идентификатор и другой пароль из числа хранящихся в именованном соединении 
</TD>
</TR>

<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Never (Никогда) 
</TD>
<TD VALIGN="TOP">
Указывает, что Visual FoxPro никогда не открывает диалоговое окно входа в базу данных 
</TD>
</TR>
</TABLE>
<P>
В области Data processing (Обработка данных) определяются свойства, связанные с обработкой данных соединения (табл. 22.3). 
</P>
<P>
Таблица 22.3. Опции области Data processing 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Наименование 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Asynchronous execution 
</P>
<P>
(Асинхронное выполнение) 
</TD>
<TD VALIGN="TOP">
Задает признак асинхронного соединения 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Display warnings (Показывать предупреждения) 
</TD>
<TD VALIGN="TOP">
Задает признак отображения неперехватываемых предупреждений 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Batch processing (Пакетная обработка данных) 
</TD>
<TD VALIGN="TOP">
Задает пакетный режим обработки данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Automatic transactions 
</P>
<P>
(Автоматические транзакции) 
</TD>
<TD VALIGN="TOP">
Задает автоматическую обработку транзакций 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Packet size (Размер пакета данных) 
</TD>
<TD VALIGN="TOP">
Задает размер пакета данных, передаваемого от сервера базы данных 
</TD>
</TR>
</TABLE>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Для определения значений параметров области Data processing (Обработка данных) вы можете использовать функцию&nbsp; DBSETPROP ().
</font> 
</P>
<P>
Область Timeout intervals (Интервалы времени) содержит опции, устанавливающие временные параметры обработки данных (табл. 22.4). 
</P>
<P>
Таблица 22.4. Опции области Timeout intervals 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Наименование 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Connection (sec) 
</P>
<P>
(Соединение) 
</TD>
<TD VALIGN="TOP">
Задает интервал тайм-аута соединения в секундах 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Query (sec) (Запрос) 
</TD>
<TD VALIGN="TOP">
Задает интервал тайм-аута запроса в секундах 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Idle (min) (Холостой режим) 
</TD>
<TD VALIGN="TOP">
Задает интервал тайм-аута холостого режима в минутах. Активные соединения по истечении этого интервала времени деактивизируются 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Wait time (ms) (Время ожидания) 
</TD>
<TD VALIGN="TOP">
Задает промежуток времени в миллисекундах, по истечении которого Visual FoxPro может определить, завершено ли выполнение оператора SQL 
</TD>
</TR>
</TABLE>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Для определения значений параметров области Data processing (Обработка данных) вы можете использовать функцию DBSETPROP ().
</font> 
</P>
<P>
По умолчанию для именованного соединения задается имя Connect 1. При закрытии окна конструктора соединений открывается диалоговое окно Save (Сохранить) (рис. 22.6), предлагающее ввести подходящее имя соединения. 
</P>
<IMG src="gl22-6.jpg" alt="gl22-6.jpg" width="408" height="134" ></IMG>
<P>
Рис. 22.6. Ввод имени соединения 
</P>
<P>
Все созданные вами именованные соединения отображаются в разделе Connections (Соединения) списка Database (База данных). Например, на рис. 22.7 приведены именованные соединения с источниками данных Access, Microsoft SQL Server и Microsoft Excel. 
</P>
<IMG src="gl22-7.jpg" alt="gl22-7.jpg" width="500" height="423" ></IMG>
<P>
Рис. 22.7. Именованные соединения 
</P>
<P>
Для изменения параметров именованного соединения выберите требуемое соединение и нажмите кнопку Modify (Модифицировать). Откроется окно конструктора соединений, в котором вы можете изменить любые параметры соединения. 
</P>
<p>&nbsp;
<a NAME="4"></a><font size="4">Настройка параметров удаленных представлений и соединений в диалоговом окне Options
</font> 
</P>
<P>
Прежде чем запускать мастера удаленных представлений, вы можете установить опции 
для принимаемых по умолчанию параметров удаленных представлений и соединений, 
используя вкладку Remote Data (Удаленные данные) диалогового окна Options (Параметры) (рис. 22.8). 
</P>
<IMG src="gl22-8.jpg" alt="gl22-8.jpg" width="478" height="416" ></IMG>
<P>
Рис. 22.8. Настройка параметров удаленных представлений и соединений 
</P>
<P>
Область Remote view defaults (Удаленное представление по умолчанию) содержит параметры (табл. 22.5), используемые по умолчанию при создании удаленных представлений. 
</P>
<P>
Таблица 22.5. Параметры удаленного представления 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Параметр 
</TD>
<TD VALIGN="TOP">
Описание 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Share connection (Совместное подключение) 
</TD>
<TD VALIGN="TOP">
Указывает, что в новых представлениях будет использоваться текущее совместно используемое соединение 
</TD>
</TR>

<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Fetch memo
(Выборка Memo-поля) 
</TD>
<TD VALIGN="TOP">
Указывает, что Memo-поле не будет выбираться из источника данных до тех пор, пока оно не будет активизировано в представлении данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
SQL updates: Criteria (Критерии SQL-обновления) 
</TD>
<TD VALIGN="TOP">
Задает критерий обновления данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
SQL updates: Method (Методы SQL-обновления) 
</TD>
<TD VALIGN="TOP">
Задает метод обновления данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Records to fetch at a time
(Выборка записей за промежуток времени) 
</TD>
<TD VALIGN="TOP">
Задает количество записей, возвращаемых за один раз из удаленного источника данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Maximum records to fetch
(Максимальная выборка записей за промежуток времени) 
</TD>
<TD VALIGN="TOP">
Ограничивает общее число записей,  возвращаемых в представлении 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Use memo for fields &gt;=
(Использовать перевод символьных данных в Мемо-поля) 
</TD>
<TD VALIGN="TOP">
Задает условие преобразования длинных символьных полей в Memo-поля в выводе представления 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Records to batch update
(Количество обновляемых одновременно записей) 
</TD>
<TD VALIGN="TOP">
Задает число записей, подлежащих обновлению в одной команде 
</TD>
</TR>
</TABLE>
<P>
Область Connection defaults содержит параметры, используемые при создании именованных соединений (табл. 22.6). 
</P>
<P>
Таблица 22.6. Параметры именованного соединения 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Параметр 
</TD>
<TD VALIGN="TOP">
Описание 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Asynchronous execution
(Асинхронное выполнение) 
</TD>
<TD VALIGN="TOP">
Задает признак асинхронной обработки 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Display warnings (Показывать предупреждения) 
</TD>
<TD VALIGN="TOP">
Задает режим выдачи предупреждающих сообщений 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Batch processing (Пакетная обработка) 
</TD>
<TD VALIGN="TOP">
Обеспечивает пакетную обработку. Если установить этот переключатель, Visual FoxPro не будет       возвращать       результаты       вызова SQLEXEC ( )  до тех пор, пока не поступят все отдельные результирующие наборы 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Automatic transactions
(Автоматические транзакции) 
<P>
Show login (Показывать окно приглашения) 
</TD>
<TD VALIGN="TOP">
Определяет, каким образом соединение управляет ходом транзакций в удаленной таблице
<span lang="ru">о</span>тображает диалоговое окно ввода регистрационного приглашения только в том 
случае, если в определении соединения или представления не задана информация регистрации 
</TD>
</TR>

<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Connection timeout (sec)
(Ожидание соединения) 
</TD>
<TD VALIGN="TOP">
Задает интервал времени (в секундах), в течение которого допускается ожидание 
установки соединения с удаленным сервером. Если в течение этого времени соединение не устанавливается, Visual FoxPro генерирует ошибку 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Idle timeout (min) (Холостой режим) 
</TD>
<TD VALIGN="TOP">
Задает интервал времени (в минутах), в течение которого допускается простаивание, прежде чем соединение будет прекращено. Если в течение этого времени не был сделан запрос к серверу, Visual FoxPro разрывает соединение. Однако, если сделать запрос к серверу по истечении интервала тайм-аута для соединения, Visual FoxPro автоматически попытается его восстановить 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Query timeout (sec) (Ожидание запроса) 
</TD>
<TD VALIGN="TOP">
Задает интервал времени (в секундах), в течение которого допускается ожидание от сервера ответа на запрос. Если сервер тратит на обра. ботку больше заданного числа секунд, Visual FoxPro генерирует ошибку 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Wait time (ms) (Время ожидания завершения запроса) 
</TD>
<TD VALIGN="TOP">
Задает интервал времени  (в  миллисекундах) между проверками на завершение запроса 
</TD>
</TR>
</TABLE>
<p>&nbsp;
<a NAME="5"></a><font size="4">Создание удаленного представления данных </font> 
</P>
<P>
После того как был определен источник данных или именованное соединение, можно создать удаленное представление. Для этого выполните одно из следующих действий: 
</P>
<ul>
  <li>откройте базу данных и вызовите мастера удаленных представлений; </li>
  <li>в диспетчере проектов из списка Databases (Базы данных) выберите раздел 
  Remote Views (Удаленные представления), затем нажмите кнопку New (Новый) для 
  вызова конструктора представлений; </li>
  <li>используйте команду CREATE   SQL VIEW  с предложением REMOTE и/или
 CONNECTION. </li>
</ul>
<P>
Рассмотрим каждый из этих вариантов создания удаленного представления данных на примерах использования электронной таблицы Microsoft Excel и базы данных Microsoft SQL Server. 
</P>
<p>&nbsp;
<a NAME="6"></a><font size="4">Использование мастера удаленных представлений </font> 
</P>
<P>
Мастер удаленных представлений создает представления с использованием удаленных данных (ODBC). Предлагая ответить на ряд простых вопросов, мастер помогает вам выполнить процедуру в несколько этапов; при этом вы должны задать базы данных, таблицы и поля, которые хотите использовать в своем представлении. Перед этим вы должны создать базу данных, в которой будет сохранено представление, а также определить источник данных или соединение. 
</P>
<P>
Для запуска мастера удаленных представлений в меню Tools (Сервис) выберите команду Wizards (Мастера), а затем опцию Query (Запрос), потом в открывшемся диалоговом окне Wizard Selection (Выбор мастера) выберите значение Remote View Wizard (Мастер удаленного представления) (рис. 22.9). 
</P>
<IMG src="gl22-9.jpg" alt="gl22-9.jpg" width="292" height="252" ></IMG>
<P>
Рис. 22.9. Выбор мастера удаленных представлений 
</P>
<P>
На первом шаге вы выбираете источник данных из списка имеющихся источников данных или созданных вами именованных соединений (рис. 22.10). 
</P>
<P>
Если удаленный источник данных требует идентификации пользователя, то на экране открывается диалоговое окно ввода имени пользователя и пароля (рис. 22.11). 
</P>
<P>
Введите имя пользователя и пароль входа в базу данных. После этого откроется 
диалоговое окно выбора полей (рис. 22.12), помещаемых в создаваемое 
представление. Вы можете выбирать поля из нескольких таблиц или представлений базы данных, с которой вы соединились. Вначале выберите одну таблицу и перенесите поля выбранной таблицы в список Selected Fields (Выбранные поля), а затем выберите поля из другой таблицы или другого представления. 
</P>
<IMG src="gl22-10.jpg" alt="gl22-10.jpg" width="492" height="360" ></IMG>
<P>
Рис. 22.10. Выбор источника данных 
</P>
<IMG src="gl22-11.jpg" alt="gl22-11.jpg" width="359" height="158" ></IMG>
<P>
Рис. 22.11. Ввод имени пользователя и пароля 
</P>
<IMG src="gl22-12.jpg" alt="gl22-12.jpg" width="492" height="360" ></IMG>
<P>
Рис. 22.12. Выбор полей удаленного представления 
</P>
<P>
Если вы выберете более одной таблицы, вам необходимо определить отношения между таблицами (рис. 22.13). Для этого выберите нужные поля из приведенных списков и нажмите кнопку Add (Добавить). 
</P>
<IMG src="gl22-13.jpg" alt="gl22-13.jpg" width="492" height="360" ></IMG>
<P>
Рис. 22.13. Определение отношения между таблицами 
</P>
<IMG src="gl22-14.jpg" alt="gl22-14.jpg" width="500" height="429" ></IMG>
<P>
Рис. 22.14. Отображение списка удаленных представлений 
</P>
<P>
На следующих двух шагах создания удаленного представления укажите порядок 
сортировки информации и фильтр для ограничения выбираемых данных. На последнем шаге укажите режим завершения процесса создания и введите имя создаваемого удаленного представления. Вы можете просто сохранить 
его, открыть для просмотра или открыть в конструкторе представлений. После создания удаленного представления его имя появится в разделе Remote Views (Удаленные представления) (рис. 22.14). После того как удаленное представление сохранено, его можно открыть и модифицировать в конструкторе представлений, как любое другое представление. 
</P>
<P>
Для просмотра данных созданного удаленного представления выберите его из раздела Remote Views (Удаленные представления) и нажмите кнопку Browse (Обзор). На рис. 22.15 вы видите данные из созданного удаленного представления. 
</P>
<IMG src="gl22-15.jpg" alt="gl22-15.jpg" width="500" height="221" ></IMG>
<P>
Рис. 22.15. Просмотр данных удаленного представления 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Если удаленный источник данных требует идентификации пользователя, то при открытии удаленного представления данных на экране открывается диалоговое окно ввода имени пользователя и пароля.
</font> 
</P>
<p>&nbsp;
<a NAME="7"></a><font size="4">Использование конструктора представлений </font> 
</P>
<P>
Для создания удаленного представления с помощью конструктора представлений в 
диспетчере проектов из списка Databases (Базы данных) выберите раздел Remote 
Views (Удаленные представления), а затем нажмите кнопку New (Новый). На экране 
появится диалоговое окно выбора источника данных Select Connection or Data Source (Выбрать соединение или источник данных) (рис. 22.16). 
</P>
<IMG src="gl22-16.jpg" alt="gl22-16.jpg" width="408" height="276" ></IMG>
<P>
Рис. 22.16. Диалоговое окно Select Connection or Data Source 
</P>
<P>
Выберите источник данных или соединение, введите идентификатор и пароль доступа 
к базе данных. Далее, как и при создании локального представления данных, выберите используемые в представлении данных таблицы и поля выбранных таблиц (рис. 22.17). 
</P>
<P>
При создании удаленных представлений данных необходимо обратить внимание на 
вкладку Update Criteria (Критерии обновления), в которой задаются условия обновления представлений. 
</P>
<P>
На этой вкладке из списка Table (Таблица) выбирается таблица, для которой определяются установки вкладки Update Criteria (Критерии обновления). Флажок Send SQL updates (Отправить SQL-обновление) указывает, должны ли данные в действительности обновляться на диске. 
</P>
<P>
Область SQL WHERE clause includes (Включение в запрос операторов предложения WHERE) содержит опции, позволяющие задать способ формирования предложения WHERE (табл. 22.7). 
</P>
<IMG src="gl22-17.jpg" alt="gl22-17.jpg" width="500" height="428" ></IMG>
<P>
Рис. 22.17. Выбор полей представления данных 
</P>
<P>
Таблица 22.7. Опции области SQL WHERE clause includes 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Опция 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Key fields only (Только ключевые поля) 
</TD>
<TD VALIGN="TOP">
Указывает,  что предложение WHERE,   используемое для обновления удаленных таблиц, включает только поля, входящие в список Field name (Имя поля) 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Key and updateable fields
(Ключевые и доступные для изменения поля) 
</TD>
<TD VALIGN="TOP">
Указывает,  что  предложение  WHERE,  используемое для обновления удаленных таблиц,  включает поля, входящие в список Field name (Имя поля), а также все обновляемые поля 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Key and modified fields
(Ключевые и модифицированные поля) 
</TD>
<TD VALIGN="TOP">
Указывает,  что  предложение  WHERE, используемое для обновления удаленных 
таблиц, включает поля, входящие в список Field name (Имя поля), и все остальные изменившиеся поля 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Key and timestamp
(Ключевые поля и отметки времени) 
</TD>
<TD VALIGN="TOP">
Указывает,  что  предложение  WHERE,   используемое для обновления удаленных таблиц, включает первичные поля, входящие в список Field name (Имя поля), а также сравнение по отметкам времени 
</TD>
</TR>
</TABLE>
<P>
В области Update using (Строка обновления) задается способ обновления полей на сервере базы данных (табл. 22.8). 
</P>
<P>
Таблица 22.8. Опции области Update using 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Опция 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
SQL DELETE then INSERT 
</TD>
<TD VALIGN="TOP">
Указывает, что сначала исходная запись таблицы базы данных будет удалена, а затем будет добавлена новая запись 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
SQL UPDATE 
</TD>
<TD VALIGN="TOP">
Указывает, что запись таблицы базы данных будет модифицироваться 
</TD>
</TR>
</TABLE>
<p>&nbsp;
<a NAME="8"></a><font size="4">Использование команды CREATE SQL VIEW </font> 
</P>
<P>
Для создания удаленных представлений данных вы можете использовать команду CREATE SQL VIEW, синтаксис которой приведен ниже: 
</P>
<blockquote>
<P>
CREATE  SQL VIEW   [имяПредставления]    [REMOTE]  
</P>
<P>
[CONNECTION имяСоединения 
</P>
<P>
|CONNECTION имяИсточникаДанных] 
</P>
</blockquote>
<P>
Для создания удаленного представления данных необходимо указать признак удаленного представления с помощью ключевого слова REMOTE. Имя удаленного соединения или источника данных задается с помощью параметра CONNECTION. 
</P>
<P>
Вы также можете задать определение представления с помощью SQL выражения, которым может быть любой допустимый оператор SQL SELECT, который не следует заключать в кавычки. 
</P>
<P>
Например, чтобы создать удаленное представление данных для таблицы Goods, расположенной в базе данных Microsoft SQL Server и для которой определено соединение SQLServer, вы можете использовать следующие команды: 
</P>
<blockquote>
<P>
 OPEN DATABASE SALES 
</P>
<P>
 CREATE SQL VIEW SQLServerGoods 
</P>
<P>
 CONNECTION SQLServer 
</P>
<P>
 AS SELECT * FROM GOODS 
</P>
</blockquote>
<p>&nbsp;
<a NAME="9"></a><font size="4">Особенности использования удаленных представлений данных для электронных таблиц Microsoft Excel
</font> 
</P>
<P>
При использовании ODBC-драйвера Microsoft Excel для создания удаленного представления данных создается таблица Visual FoxPro или курсор. Эта таблица содержит выбранные данные из электронной таблицы Microsoft 
Excel. Однако, если ячейка таблицы содержит текст, в таблице Visual FoxPro он отображается в виде Memo-поля.</P>
<P>
Это связано с тем, что ODBC-драйвер передает текстовые данные в виде строки 
длиной 255 символов. Так как Visual FoxPro не может отображать в текстовом поле 
более 254 символов, любые текстовые данные помещаются в Memo-поле. Приемлемым 
решением этой проблемы является создание новых текстовых полей и копирование в них информации из Memo-полей командой, аналогичной следующей: 
</P>
<P>
 REPLACE ALL sqlchar WITH TRIM(sqlntemo) 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">При обновлении данных в многоуровневом представлении изменения отражаются в том представлении, на котором основано представление верхнего уровня. Если нужно обновить базовые таблицы многоуровневого представления, то необходимо применить команду TABLEUPDATE для каждого представления многоуровневой структуры.
</font> 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Visual FoxPro автоматически выполняет команду TABLEUPDATE при закрытии представления. При этом представления верхнего уровня закрываются первыми, поэтому вам придется обновлять представления с каждого верхнего уровня на каждый последующий нижний уровень. После закрытия последнего (самого нижнего уровня) представления базовые таблицы для данных представлений будут содержать полный список всех выполненных обновлений.
</font> 
</P>
<p>&nbsp;
<a NAME="10"></a><font size="4">Совместно используемые соединения </font> 
</P>
<P>
При создании удаленных представлений вы можете воспользоваться совместно используемыми соединениями. В этом случае одно активное соединение используется как информационный канал для нескольких удаленных представлений. 
</P>
<P>
При совместном использовании активного соединения:  
</P>
<ul>
  <li>уменьшается нагрузка на ресурсы системы; </li>
  <li>уменьшается количество связей на удаленном сервере; </li>
  <li>уменьшаются накладные расходы на связи с серверами. </li>
</ul>
<P>
Для определения разделяемого соединения воспользуйтесь любым из следующих способов: 
</P>
<ul>
  <li>в диспетчере проектов выберите в меню Tools (Сервис) команду Options 
(Параметры). Откройте вкладку Remote Data (Удаленные данные), установите флажок Share Connection (Совместное подключение), расположенный в области Remote View Defaults (Значение по умолчанию для удаленных представлений), и нажмите ОК; 
  </li>
  <li>в окне конструктора представлений в меню Query (Запрос) выберите команду 
  Advanced Options (Дополнительные параметры) и в открывшемся диалоговом окне 
  Advanced Options (Дополнительные параметры) установите флажок Share Connection 
  (Совместное подключение);  
  </li>
  <li>используйте команду CREATE SQL VIEW с ключевым словом SHARE. </li>
</ul>
<p>&nbsp;
<a NAME="11"></a><font size="4">Комбинирование в представлении локальных и удаленных данных
</font> 
</P>
<P>
Актуальной задачей при разработке приложений, использующих удаленные данные, является комбинирование в представлении локальных и удаленных данных. В Visual FoxPro данная задача решается достаточно просто. Прежде всего, вы должны создать удаленные представления для данных, которые будут использоваться совместно с локальными. 
</P>
<P>
Затем в диспетчере проектов выберите раздел Local Views (Локальные 
представления) и нажмите кнопку New (Новый), чтобы открыть конструктор 
представлений. Добавьте в новое представление любую комбинацию таблиц, локальных 
и удаленных представлений. Например, вы можете объединить в одном представлении 
данные из локальной таблицы Ordsaied и удаленного представления данных Microsoft 
SQL, содержащего список товаров. 
</P>
<P>
Для создания комбинированного представления вы можете использовать также команду CREATE SQL VIEW, 
Например, чтобы создать локальное представление, комбинирующее информацию из локальной таблицы ordsaiem и удаленной таблицы customer (расположенной на сервере базы данных SQL Server), используйте следующий код: 
</P>
<blockquote>
<P>
 OPEN DATABASE SALES 
</P>
<P>
 CREATE SQL VIEW localORDSALEM<span lang="ru">_</span>remoteCUSTOMER; 
</P>
<P>
 AS SELECT * FROM SQLSERVERCUSTOMER, ORDSALEM 
</P>
<P>
 WHERE SQLSERVERCUSTOMER.iCdCustcmer =  
</P>
<P>
 ORDSALEM. iCdCustomer 
</P>
</blockquote>
<p>&nbsp;
<a NAME="12"></a><font size="4">Настройка представления с помощью словаря базы данных </font> 
</P>
<P>
Так как сведения о представлении хранятся в словаре базы данных, вы можете определить для него следующие свойства: 
</P>
<ul>
  <li>заголовок поля; </li>
  <li>комментарии для представления и его полей; </li>
  <li>значения полей, принимаемые по умолчанию; </li>
  <li>правила проверки достоверности данных на уровне поля и записи, </li>
</ul>
<P>
Для определения свойств полей представления данных в окне конструктора 
представления перейдите на вкладку Fields (Поля) и нажмите кнопку Properties (Свойства). Откроется диалоговое окно View Field Properties (Показать свойства поля).</P>
<P>
Раскрывающийся список Field (Поле) в этом диалоговом окне содержит перечень всех полей представления. Для определения свойств поля необходимо сначала выбрать его из этого списка. 
</P>
<P>
В области Field validation (Проверка достоверности данных поля) вы можете задать условия проверки достоверности данных на уровне поля при вводе данных (табл. 22.9). 
</P>
<P>
Таблица 22.9. Поля области Field validation 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Поле 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Rule (Правило) 
</TD>
<TD VALIGN="TOP">
Задает правило проверки достоверности данных на уровне поля 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Message 
</P>
<P>
(Сообщение) 
</TD>
<TD VALIGN="TOP">
Задает сообщение об ошибке, которое будет выдаваться, если введенные данные не согласуются с правилом уровня поля 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Default value 
</P>
<P>
(Значение по умолчанию) 
</TD>
<TD VALIGN="TOP">
Задает для поля значение по умолчанию 
</TD>
</TR>
</TABLE>
<P>
Для удаленных данных правило проверки достоверности данных на уровне поля задается средствами сервера базы данных. Вы можете задать локальное правило для: 
</P>
<ul>
  <li>уменьшения времени отклика системы; </li>
  <li>уменьшения загрузки сетевых ресурсов; </li>
  <li>проверки данных перед их пересылкой удаленному источнику данных. </li>
</ul>
<P>
Visual FoxPro не сравнивает локальное и удаленное правило проверки достоверности данных. 
</P>
<P>
В области Display (Отобразить) вы можете задать условия проверки достоверности данных на уровне поля при отображении и вводе данных (табл. 22.10). 
</P>
<P>
Таблица 22.10. Поля области Display 
</P>
<TABLE BORDER="1">
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Поле 
</TD>
<TD VALIGN="TOP">
Назначение 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Format (Формат) 
</TD>
<TD VALIGN="TOP">
Задает формат отображения данных. Этот формат используется в окне Browse, отчетах и формах 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Input mask
(Маска ввода) 
</TD>
<TD VALIGN="TOP">
Задает маску ввода данных 
</TD>
</TR>
<TR ALIGN="LEFT" VALIGN="TOP">
<TD VALIGN="TOP">
Caption
(Описание) 
</TD>
<TD VALIGN="TOP">
Задает описательное имя поля. Название отображается в качестве заголовка столбца при просмотре таблицы. Оно может включать до 128 символов 
</TD>
</TR>
</TABLE>
<P>
Если вы планируете использовать представление данных в формах, то можете использовать опции области Map field type to classes (Установить соответствие между типами полей и классами) для задания типа объекта управления, создаваемого в форме при размещении данного поля. </P>
<P>
Для удаленных представлений данных вы можете определить тип и размер поля представления данных. Используйте для этого опции области Data mapping (Соответствие типов данных). 
</P>
<P>
Поле редактирования Comment (Комментарий) содержит описательный комментарий о данном поле. Все, что вы здесь введете, при выборе поля будет отображено в качестве описания в нижней части диспетчера проектов. 
</P>
<P>
<font color="#008000"><b>Замечание</b></font></P>
<P>
<font color="#008000">Для определения свойств полей представления данных вы можете использовать 
<span lang="ru">функцию</span> DBSETPROP (<span lang="ru">)</span> . </font> 
</P>
</BODY>
</HTML>